(function(){"use strict";function e([e,...t],...n){return n.reduce((e,n)=>e.concat(n,t.shift()),[e]).filter((e)=>null!=e).join("")}function n(...e){return Object.assign({},...e)}function r(e){return"#"===e.charAt(0)&&(e=e.substr(1)),3===e.length&&(e=e.split("").map((e)=>e+e).join("")),e.match(/.{1,2}/g).map((e)=>parseFloat((parseInt(e,16)/255).toFixed(2)))}function o(e){return e.reduce((e,t)=>{let n=(~~(255*t)).toString(16);return 1===n.length&&(n="0"+n),e+n},"#")}function a(e,t,n){let o,r,a;if(0==t)o=r=a=n;else{function i(e,n,r){return 0>r&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(n-e)*r:r<1/2?n:r<2/3?e+6*((n-e)*(2/3-r)):e}let s=0.5>n?n*(1+t):n+t-n*t,c=2*n-s;o=i(c,s,e+1/3),r=i(c,s,e),a=i(c,s,e-1/3)}return[o,r,a]}function i(){let e=new Xe(3);return e[0]=0,e[1]=0,e[2]=0,e}function s(e,t,n){let r=new Xe(3);return r[0]=e,r[1]=t,r[2]=n,r}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function m(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function d(e,t){let n=t[0]-e[0],r=t[1]-e[1],o=t[2]-e[2];return we(n*n+r*r+o*o)}function p(e,t){let n=t[0],r=t[1],o=t[2],a=n*n+r*r+o*o;return 0<a&&(a=1/we(a),e[0]=t[0]*a,e[1]=t[1]*a,e[2]=t[2]*a),e}function l(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function f(e,t,n){let r=t[0],o=t[1],a=t[2],i=n[0],s=n[1],c=n[2];return e[0]=o*c-a*s,e[1]=a*i-r*c,e[2]=r*s-o*i,e}function u(e,n,r,o){let t=n[0],a=n[1],i=n[2];return e[0]=t+o*(r[0]-t),e[1]=a+o*(r[1]-a),e[2]=i+o*(r[2]-i),e}function g(e,t,n){let r=t[0],o=t[1],a=t[2],i=n[3]*r+n[7]*o+n[11]*a+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*o+n[8]*a+n[12])/i,e[1]=(n[1]*r+n[5]*o+n[9]*a+n[13])/i,e[2]=(n[2]*r+n[6]*o+n[10]*a+n[14])/i,e}function h(){let e=new Xe(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,t){let n=t[0],r=t[1],o=t[2],a=t[3],i=t[4],s=t[5],c=t[6],m=t[7],d=t[8],_=t[9],l=t[10],f=t[11],u=t[12],p=t[13],g=t[14],h=t[15],y=n*s-r*i,v=n*c-o*i,b=n*m-a*i,k=r*c-o*s,x=r*m-a*s,A=o*m-a*c,E=d*p-_*u,F=d*g-l*u,R=d*h-f*u,T=_*g-l*p,w=_*h-f*p,L=l*h-f*g,P=y*L-v*w+b*T+k*R-x*F+A*E;return P?(P=1/P,e[0]=(s*L-c*w+m*T)*P,e[1]=(o*w-r*L-a*T)*P,e[2]=(p*A-g*x+h*k)*P,e[3]=(l*x-_*A-f*k)*P,e[4]=(c*R-i*L-m*F)*P,e[5]=(n*L-o*R+a*F)*P,e[6]=(g*b-u*A-h*v)*P,e[7]=(d*A-l*b+f*v)*P,e[8]=(i*w-s*R+m*E)*P,e[9]=(r*R-n*w-a*E)*P,e[10]=(u*x-p*b+h*y)*P,e[11]=(_*b-d*x-f*y)*P,e[12]=(s*F-i*T-c*E)*P,e[13]=(n*T-r*F+o*E)*P,e[14]=(p*v-u*k-g*y)*P,e[15]=(d*k-_*v+l*y)*P,e):null}function v(e,t,n){let r=t[0],o=t[1],a=t[2],i=t[3],s=t[4],c=t[5],m=t[6],d=t[7],_=t[8],l=t[9],f=t[10],u=t[11],p=t[12],g=t[13],h=t[14],y=t[15],v=n[0],b=n[1],k=n[2],x=n[3];return e[0]=v*r+b*s+k*_+x*p,e[1]=v*o+b*c+k*l+x*g,e[2]=v*a+b*m+k*f+x*h,e[3]=v*i+b*d+k*u+x*y,v=n[4],b=n[5],k=n[6],x=n[7],e[4]=v*r+b*s+k*_+x*p,e[5]=v*o+b*c+k*l+x*g,e[6]=v*a+b*m+k*f+x*h,e[7]=v*i+b*d+k*u+x*y,v=n[8],b=n[9],k=n[10],x=n[11],e[8]=v*r+b*s+k*_+x*p,e[9]=v*o+b*c+k*l+x*g,e[10]=v*a+b*m+k*f+x*h,e[11]=v*i+b*d+k*u+x*y,v=n[12],b=n[13],k=n[14],x=n[15],e[12]=v*r+b*s+k*_+x*p,e[13]=v*o+b*c+k*l+x*g,e[14]=v*a+b*m+k*f+x*h,e[15]=v*i+b*d+k*u+x*y,e}function b(e,t,n,r){let o=t[0],a=t[1],i=t[2],s=t[3],c=o+o,m=a+a,d=i+i,_=o*c,l=o*m,f=o*d,u=a*m,p=a*d,g=i*d,h=s*c,y=s*m,v=s*d,b=r[0],k=r[1],x=r[2];return e[0]=(1-(u+g))*b,e[1]=(l+v)*b,e[2]=(f-y)*b,e[3]=0,e[4]=(l-v)*k,e[5]=(1-(_+g))*k,e[6]=(p+h)*k,e[7]=0,e[8]=(f+y)*x,e[9]=(p-h)*x,e[10]=(1-(_+u))*x,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function k(e,t,n,r,o){let a=1/Math.tan(t/2),i=1/(r-o);return e[0]=a/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(o+r)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*o*r*i,e[15]=0,e}function x(e,t,n,r){let o,a,i,s,c,m,d,_,l,f,u=t[0],p=t[1],g=t[2],h=r[0],y=r[1],v=r[2],b=n[0],k=n[1],x=n[2];return Re(u-b)<We&&Re(p-k)<We&&Re(g-x)<We?mat4.identity(e):(d=u-b,_=p-k,l=g-x,f=1/we(d*d+_*_+l*l),d*=f,_*=f,l*=f,o=y*l-v*_,a=v*d-h*l,i=h*_-y*d,f=we(o*o+a*a+i*i),f?(f=1/f,o*=f,a*=f,i*=f):(o=0,a=0,i=0),s=_*i-l*a,c=l*o-d*i,m=d*a-_*o,f=we(s*s+c*c+m*m),f?(f=1/f,s*=f,c*=f,m*=f):(s=0,c=0,m=0),e[0]=o,e[1]=s,e[2]=d,e[3]=0,e[4]=a,e[5]=c,e[6]=_,e[7]=0,e[8]=i,e[9]=m,e[10]=l,e[11]=0,e[12]=-(o*u+a*p+i*g),e[13]=-(s*u+c*p+m*g),e[14]=-(d*u+_*p+l*g),e[15]=1,e)}function A(){let e=new Xe(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function E(){let e=new Xe(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function F(){let e=new Xe(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function R(e,t,n){n*=0.5;let r=Fe(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Ee(n),e}function T(e,t,n){let r=t[0],o=t[1],a=t[2],i=t[3],s=n[0],c=n[1],m=n[2],d=n[3];return e[0]=r*d+i*s+o*m-a*c,e[1]=o*d+i*c+a*s-r*m,e[2]=a*d+i*m+r*c-o*s,e[3]=i*d-r*s-o*c-a*m,e}function w(e,n,r,o){let t,a,i,s,c,m=n[0],d=n[1],_=n[2],l=n[3],f=r[0],u=r[1],p=r[2],g=r[3];return a=m*f+d*u+_*p+l*g,0>a&&(a=-a,f=-f,u=-u,p=-p,g=-g),1e-6<1-a?(t=Math.acos(a),i=Fe(t),s=Fe((1-o)*t)/i,c=Fe(o*t)/i):(s=1-o,c=o),e[0]=s*m+c*f,e[1]=s*d+c*u,e[2]=s*_+c*p,e[3]=s*l+c*g,e}function L(e,t){let n,r=t[0]+t[4]+t[8];if(0<r)n=we(r+1),e[3]=0.5*n,n=0.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let o=(r+1)%3,a=(r+2)%3;n=we(t[3*r+r]-t[3*o+o]-t[3*a+a]+1),e[r]=0.5*n,n=0.5/n,e[3]=(t[3*o+a]-t[3*a+o])*n,e[o]=(t[3*o+r]+t[3*r+o])*n,e[a]=(t[3*a+r]+t[3*r+a])*n}return e}function P(e,t,n,r){const o=Float32Array.of(...t,...n,...r);return rt(e,L(e,o))}function S(e){return e*Ae/180}function B(e){const t=ct.createBuffer();return ct.bindBuffer(ct.ARRAY_BUFFER,t),ct.bufferData(ct.ARRAY_BUFFER,new Float32Array(e),ct.STATIC_DRAW),t}function U(e){const t=ct.createBuffer();return ct.bindBuffer(ct.ELEMENT_ARRAY_BUFFER,t),ct.bufferData(ct.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),ct.STATIC_DRAW),t}function I(e,t){const n=ct.createShader(e);if(ct.shaderSource(n,t),ct.compileShader(n),!ct.getShaderParameter(n,ct.COMPILE_STATUS))throw ct.getShaderInfoLog(n);return n}function q(e,t){const n=ct.createProgram();if(ct.attachShader(n,e),ct.attachShader(n,t),ct.linkProgram(n),!ct.getProgramParameter(n,ct.LINK_STATUS))throw ct.getProgramInfoLog(n);return n}function M(e){Gt=e}function D(e=0,t=1){return xe(Ht()*(t-e+1)+e)}function C(e=0,t=1){return Ht()*(t-e)+e}function O(e){return e[D(0,e.length-1)]}function N([e,t],n,r=1.5){const o=C(0,2*Ae),a=C(0,n);return tt(e+a*Ee(o),r,t+a*Fe(o))}function j(e){const t=C(-Ae/10,Ae/10),n=C(0,Ae/10),r=tt(Ee(n)*Fe(t),Fe(n),Ee(n)*Ee(t));return p(r,r),g(r,r,e)}function Y(e,t){return e.reduce((e,n,r)=>e+n*t[r],0)}function G(e){return we(Y(e,e))}function H(e,t){const n=V.slice();return m(n,e,t),G(n)}function W(e){return we(ke(1-e,2))}function X(e,t,n){const r=H(e,t),o=we(n*n)/2;return Math.max(0,1-r/o)}function Q(e,t){return Re(Y(e,t))}function K(e,t,n){const o=t.get_component(ut),a=t.get_component(Wt),i=X(e.position,o.position,n),s=Q(e.rotation,o.rotation),c=Q(o.rotation,a.rotation),m=s*(1-W(i))+c*W(i);return(i+m)/2/2}function J(e,t,n){const o=t.get_component(ut),a=X(e.position,o.position,n),i=Q(e.rotation,o.rotation);return(a*Fe(i)+i*Fe(a))/(0.8414709848078965*2)}function Z(e=0,t=1){return xe(Math.random()*(t-e+1)+e)}function $(e){return e[Z(0,e.length-1)]}function z(e,t){const n=Kt.sampleRate*e,r=Kt.createBuffer(2,n,Kt.sampleRate),o=r.getChannelData(0),a=r.getChannelData(1);for(let r=0;r<n;r++)o[r]=(2*Math.random()-1)*ke(1-r/n,t),a[r]=(2*Math.random()-1)*ke(1-r/n,t);return r}function ee(e){const t=Kt.createOscillator();t.type="sine",t.frequency.value=e;const n=Kt.createGain();n.gain.setTargetAtTime(1,Kt.currentTime,.1),n.gain.setTargetAtTime(0,Kt.currentTime+1,.1),t.connect(n),n.connect(Zt),t.start(),t.stop(Kt.currentTime+10)}function te(){const e=$(Jt);ee(e),setTimeout(te,2e3+Z(0,1e4))}function ne(e,t,n,r){this.modulator_gain=e.createGain(),this.modulator_gain.gain.value=r||300,n.connect(this.modulator_gain),this.modulator_gain.connect(t.frequency),this.connect=(e)=>{t.disconnect(),t.connect(e)},this.disconnect=(e)=>{t.disconnect(e)}}function re(e,t,n){var r=e.createGain();r.gain.value=1,t.connect(r),n.connect(r.gain),this.connect=function(e){r.disconnect(),r.connect(e)}}function oe(e,t,n,r,o,a){var i=6.90776;this.attack_time=n||0.9,this.decay_time=r||0.9,this.min=o||0,this.max=a||50,this.trigger=(n)=>{var r=n||e.currentTime;t.cancelScheduledValues(r),t.setValueAtTime(this.min,r),t.setTargetAtTime(this.max,r,this.attack_time/i),t.setTargetAtTime(this.min,r+this.attack_time+1/44100,this.decay_time/i)}}function ae(e,t){const n=7e3,r=300,o=0.9,a=3e3,i=Kt.createPanner();i.panningModel="equalpower",i.distanceModel="exponential",i.refDistance=0.3,i.setPosition(...e);const s=Kt.createOscillator(),c=Kt.createOscillator(),m=Kt.createOscillator(),d=Kt.createGain(),_=Kt.createGain(),l=Kt.createGain();c.connect(d),m.connect(_);const f=new ne(Kt,s,d),u=new re(Kt,f,_),p=new oe(Kt,l.gain),g=new oe(Kt,c.frequency),h=new oe(Kt,m.frequency),y=new oe(Kt,d.gain),v=new oe(Kt,_.gain);u.connect(l),l.connect(i),i.connect(Kt.destination),f.modulator_gain.gain.value=r+n*zt.ifrq,s.frequency.value=r+n*zt.ifrq,p.attack_time=o*zt.atk,p.decay_time=o*zt.dcy,g.max=a*zt.fmod1,g.attack_time=o*zt.atkf1,g.decay_time=o*zt.dcyf1,h.max=a*zt.fmod2,h.attack_time=o*zt.atkf2,h.decay_time=o*zt.dcyf2,y.max=zt.amod1,y.attack_time=o*zt.atka1,y.decay_time=o*zt.dcya1,v.max=-zt.amod2,v.attack_time=o*zt.atka2,v.decay_time=o*zt.dcya2,l.gain.value=0,s.start(0),c.start(0),m.start(0),p.trigger(t),g.trigger(t),h.trigger(t),y.trigger(t),v.trigger(t)}function ie(e){for(let t=0;3>t;t++)setTimeout(()=>{ae(e,Kt.currentTime+0.4*Math.random())},1.2*(1e3*zt.atk)*t)}function se(e,t,n,r,o){ie(e);for(let a=0;a<r;a++)setTimeout(()=>{const r=N([e[0],e[2]],n,100),a=new dt({components:[new ut({position:e,scale:[0.2,0.2,0.2]}),new gt({material:Nt,color:t}),new kt({frame_time:16})]});a.get_component(kt).frames=tn,a.get_component(ut).look_at(r),a.get_component(ut).rotate_ud(Ae/2),a.get_component(ut).rotate_rl(Math.PI),a.get_component(kt).create_buffers(),o.add(a),new Qt({object:a.get_component(ut),property:"position",to:r,time:1e3*en,game:o}).start().then(()=>{o.remove(a)})},15*a)}function ce(e,t){const n=a(e,rn,t);return o(n)}function me(e){M(ke(Yt/e,2)),mn=[],dn=[];const t=new Et({width:window.innerWidth,height:window.innerHeight,clear_color:"#eeeeee",far:nn});t.camera.add_component(new vt({keyboard_controlled:!1,mouse_controlled:!1,move_speed:25,rotate_speed:.5}));const n=C(0,1),r=ce(n,on),o=new It;o.get_component(ut).scale=[nn,1,nn],o.get_component(gt).set({material:Nt,color:r}),t.add(o);for(let n=0;n<ke(e,2)+1;n++)Vt(n,r,D(0,2)).forEach((e)=>{mn.push(e),t.add(e)});t.camera.get_component(ut).position=N([0,0],nn/3),t.camera.get_component(ut).look_at(O(mn).get_component(ut).position),t.camera.get_component(ut).look_at(j(t.camera.get_component(ut).matrix)),delete t.camera.get_component(vt).dir_desc[69],delete t.camera.get_component(vt).dir_desc[81];const a=D(2,4);for(let t=0;t<a;t++){const e=N([0,0],nn/3,-3);dn.push(e)}return t.on("afterrender",function e(){t.off("afterrender",e);const n={snapshot:t.canvas.toDataURL(),position:t.camera.get_component(ut).position,rotation:t.camera.get_component(ut).rotation};yn(Ne,n),t.stop()}),[t,n]}function de(e,t,n){e.camera.get_component(ut).set({position:[0,an,0],rotation:F()}),e.camera.get_component(vt).keyboard_controlled=!0,e.camera.get_component(vt).mouse_controlled=!0,e.camera.add_component(new Wt({target:n}));for(const r of e.entities)r.get_component(gt).color="#000000";e.start(),e.on("tick",()=>{for(let r=0;r<dn.length;r++)if(d(dn[r],e.camera.get_component(ut).position)<sn){se(dn[r],ce(t,on*K(n,e.camera,nn)),nn/5,cn,e),dn.splice(r,1);break}}),e.on("afterrender",function(){const r=K(n,e.camera,nn);for(const n of e.entities)n.get_component(gt).color=ce(t,on*r)})}function _e(e,t){e.stop();const n=J(t,e.camera,nn);return xe(100*n)}function le(e){fn[e.type]=performance.now()}function fe(){pe();for(const e of["mousemove","keydown"])if(fn[e]+_n<performance.now()){yn(je,e);break}}function ue(){window.addEventListener("mousemove",le),window.addEventListener("keydown",le),ln=setTimeout(fe,5e3);const e=performance.now();fn={mousemove:e,keydown:e}}function pe(){window.removeEventListener("mousemove",le),window.removeEventListener("keydown",le),clearTimeout(ln)}function ge(e,t=1){return`<div class="ui"
    onanimationend="dispatch(${Se})"
    style="
      background-color: ${e};
      animation: fadein ${t}s forwards reverse"></div>`}function he(e,t,n=1){return`<div class="ui"
    onanimationend="
      dispatch(${Pe});
      dispatch(${e.join(", ")})"
    style="
      background-color: ${t};
      animation: fadein ${n}s forwards"></div>`}function ye(t){return e`
    <div class="ui"
      onanimationend="dispatch(${He})"
      style="
        background: hsl(${360*t}, 70%, 60%);
        animation: fadein 1s 1s forwards reverse;"></div>
    <div class="ui">
      <div class="pad">Find this moment.</div>
    </div>`}function ve(){return e`
    <div class="ui action"
      onclick="dispatch(${Ge}); goto(${qe})">
      <div class="pad">Find this moment.</div>
    </div>`}function be(t,n){return e`
     <div class="box action"
       onclick="goto(${Ie}, ${n})"
       style="color: rgba(255, 255, 255, 0.35);">
       ${t}</div>
  `}var ke=Math.pow,xe=Math.floor,Ae=Math.PI,Ee=Math.cos,Fe=Math.sin,Re=Math.abs,Te=Math.min,we=Math.sqrt;const Le=100,Pe=101,Se=102,Be=0,Ue=1,Ie=2,qe=3,Me=4,De=5,Ce=6,Oe=10,Ne=11,je=12,Ye=13,Ge=14,He=15,Ve={current_scene:Be,next:[Be]},We=1e-6;let Xe="undefined"==typeof Float32Array?Array:Float32Array;const Qe=function(e){let t=e[0],n=e[1],r=e[2];return we(t*t+n*n+r*r)},Ke=function(){let e=i();return function(t,n,r,o,a,s){let c,i;for(n||(n=3),r||(r=0),i=o?Te(o*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],a(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}}(),Je=Float32Array,V=Je.of(0,0,0),Ze=Je.of(1,1,1),$e=Je.of(1,0,0),ze=Je.of(0,1,0),et=Je.of(0,0,1),tt=(...e)=>Je.of(...e),nt=function(){let e=E();return function(t,n,r,o,a,s){let c,i;for(n||(n=4),r||(r=0),i=o?Te(o*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],a(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}}(),rt=function(e,t){let n=t[0],r=t[1],o=t[2],a=t[3],i=n*n+r*r+o*o+a*a;return 0<i&&(i=1/we(i),e[0]=n*i,e[1]=r*i,e[2]=o*i,e[3]=a*i),e},ot=function(){let e=i(),t=s(1,0,0),n=s(0,1,0);return function(r,o,a){let i=l(o,a);return-0.999999>i?(f(e,t,o),1e-6>Qe(e)&&f(e,n,o),p(e,e),R(r,e,Math.PI),r):0.999999<i?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(f(e,o,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+i,rt(r,r))}}(),at=function(){let e=F(),n=F();return function(r,o,a,i,s,c){return w(e,o,s,c),w(n,a,i,c),w(r,e,n,2*c*(1-c)),r}}(),it=function(){let e=A();return function(t,n,r,o){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=o[0],e[4]=o[1],e[7]=o[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],rt(t,L(t,e))}}(),st=document.createElement("canvas"),ct=st.getContext("webgl"),mt={components:[],skip:!1};class dt{constructor(e={}){Object.assign(this,mt,e),this.entities=new Set,this.components=new Map,this.add_components(e.components)}add_component(e){e.entity=this,e.mount(),this.components.set(e.constructor,e)}add_components(e=[]){e.forEach((e)=>this.add_component(e))}get_component(e){return this.components.get(e)}get_components(...e){return e.map((e)=>this.get_component(e))}add(e){e.parent=this,this.entities.add(e)}update(e){if(!this.skip){const t=(t)=>t.update(e);this.components.forEach(t),this.entities.forEach(t)}}render(e){if(!this.skip){const t=(t)=>t.render(e);this.components.forEach(t),this.entities.forEach(t)}}}const _t={entity:null};class lt{constructor(e){Object.assign(this,_t,e)}mount(){}set(e){Object.assign(this,e)}update(){}render(){}}const ft={_scale:Ze.slice(),_rotation:F(),scale:Ze.slice(),position:V.slice(),rotation:F()};class ut extends lt{constructor(e){super(Object.assign({matrix:h(),world_matrix:h(),world_to_self:h()},ft,e))}get up(){const e=this.matrix.slice(4,7);return p(e,e)}get forward(){const e=this.matrix.slice(8,11);return p(e,e)}set position(e){b(this.matrix,this.rotation,e,this.scale)}get position(){return this.matrix.slice(12,15)}set scale(e){this._scale=e,b(this.matrix,this.rotation,this.position,e)}get scale(){return this._scale}set rotation(e){this._rotation=e,b(this.matrix,e,this.position,this.scale)}get rotation(){return this._rotation}look_at(e){const t=V.slice();m(t,e,this.position),p(t,t);const n=tt(t[2],0,-t[0]);p(n,n);const r=V.slice();f(r,t,n);const o=F();P(o,n,r,t),this.rotation=o}rotate_along(e,t){const n=F();R(n,e,t),T(n,this.rotation,n),this.rotation=n}rotate_rl(e){this.rotate_along(ze,e)}rotate_ud(e){this.rotate_along($e,e)}translate(e){const t=V.slice();c(t,this.position,e),this.position=t}get_view_matrix(e){const t=[];return c(t,this.position,this.forward),x(e,this.position,t,this.up),e}update(){this.entity.parent?v(this.world_matrix,this.entity.parent.get_component(ut).world_matrix,this.matrix):this.world_matrix=this.matrix.slice(),y(this.world_to_self,this.world_matrix)}}const pt={material:null,vertices:[],indices:[],normals:[],color:"fff",color_opacity:1};class gt extends lt{constructor(e){super(e),Object.assign(this,pt,e),this.create_buffers()}set color(e){this._color=e||"fff",this.color_vec=[...r(this._color),this.color_opacity]}get color(){return this._color}create_buffers(){this.buffers={vertices:B(this.vertices),indices:U(this.indices),qty:this.indices.length,normals:B(this.normals)}}render(){this.material.render(this.entity)}}const ht=3,yt={keyboard_controlled:!1,mouse_controlled:!1,move_speed:3.5,rotate_speed:.5,dir_desc:{37:"yl",38:"pu",39:"yr",40:"pd",65:"l",68:"r",69:"u",81:"d",83:"b",87:"f"}};class vt extends lt{constructor(e){super(e),Object.assign(this,yt,e)}handle_keys(e,{f:t=0,b:n=0,l:o=0,r:a=0,u:r=0,d:i=0,pu:s=0,pd:c=0,yl:d=0,yr:l=0}){const f=this.entity.get_component(ut),u=e/1e3*this.move_speed,h=tt(o-a,0,t-n);g(h,h,f.matrix),m(h,h,f.position),h[1]=r-i,p(h,h),_(h,h,u),f.translate(h);this.handle_mouse(e,{x:d*ht-l*ht,y:s*ht-c*ht})}handle_mouse(e,{x:t,y:n}){const r=this.entity.get_component(ut);if(0!==t||0!==n){const o=e/1e3,a=this.rotate_speed*o*t,i=this.rotate_speed*o*n,s=tt(Ee(i)*Fe(a),Fe(i),Ee(i)*Ee(a));p(s,s),g(s,s,r.matrix),r.look_at(s)}}update(e){if(this.keyboard_controlled&&this.entity.game){const t={};for(const[e,n]of Object.entries(this.dir_desc))t[n]=this.entity.game.get_key(e);this.handle_keys(e,t)}this.mouse_controlled&&this.entity.game&&this.handle_mouse(e,this.entity.game.mouse_delta)}}const bt={buffers:[],current_frame:0,next_frame:1,current_tick:0,frame_time:16};class kt extends lt{constructor(e){super(e),Object.assign(this,bt,e),this.frames&&this.frames.length&&this.create_buffers()}create_buffers(){this.number_of_frames=this.frames.length,this.entity.get_component(gt).buffers=this.frames.map((e)=>({vertices:B(e.vertices),indices:U(e.indices),qty:e.indices.length,normals:B(e.normals)}))}get_next_frame(){let e=this.current_frame;return e++,e%this.number_of_frames}update(){this.current_tick++,this.frame_delta=1-this.current_tick%this.frame_time/this.frame_time,this.current_tick%this.frame_time||(this.current_frame=this.next_frame,this.next_frame=this.get_next_frame())}}const xt={canvas:st,width:800,height:600,dom:document.body,fps:60,running:!0,fov:60,near:0.35,far:85,clear_color:"#FFFFFF",light_position:V.slice(),light_intensity:0.6},At=["keydown","keyup","mousemove"];class Et{constructor(e){Object.assign(this,xt,e),this.canvas.width=this.width,this.canvas.height=this.height,this.dom.appendChild(st),this.reset(),this.camera=new dt({components:[new ut,new vt]}),this.camera.game=this,this.projMatrix=h(),this.viewMatrix=h(),k(this.projMatrix,S(this.fov),this.width/this.height,this.near,this.far),this.tick_delta=1e3/this.fps;for(const t of At){const e="on"+t;this[e]=this[e].bind(this),window.addEventListener(t,this[e])}this.running&&this.start(),ct.enable(ct.CULL_FACE),ct.enable(ct.DEPTH_TEST),ct.clear(ct.DEPTH_BUFFER_BIT|ct.COLOR_BUFFER_BIT)}get clear_color(){return this._clear_color}set clear_color(e){this._clear_color=e;const t=r(e);ct.clearColor(t[0],t[1],t[2],1)}stop(){this.running=!1}start(){this.running=!0,this.last_tick=performance.now(),window.requestAnimationFrame((e)=>this.frame(e))}reset(){this.entities=new Set,this.listeners=new Map,this.keys={},this.mouse_delta={x:0,y:0}}destroy(){for(const e of At)window.removeEventListener(e,this[e])}emit(e,...t){if(this.listeners.has(e))for(const n of this.listeners.get(e))n(...t)}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)}onkeydown(t){this.keys[t.keyCode]=1}onkeyup(t){this.keys[t.keyCode]=0}get_key(e){return this.keys[e]||0}onmousemove(t){this.mouse_delta.x-=t.movementX,this.mouse_delta.y-=t.movementY}frame(e){if(this.running&&window.requestAnimationFrame((e)=>this.frame(e)),e>this.last_tick+this.tick_delta){const t=e-this.last_tick,n=xe(t/this.tick_delta);this.perform_ticks(n),this.render()}}perform_ticks(e){this.mouse_delta.x/=e,this.mouse_delta.y/=e;for(let t=0;t<e;t++)this.last_tick+=this.tick_delta,this.update();this.mouse_delta.x=0,this.mouse_delta.y=0}update(){this.emit("tick",this.last_tick),this.entities.forEach((e)=>e.update(this.tick_delta)),this.camera.update(this.tick_delta),this.camera.get_component(ut).get_view_matrix(this.viewMatrix)}render(){ct.clear(ct.COLOR_BUFFER_BIT|ct.DEPTH_BUFFER_BIT),ct.viewport(0,0,this.canvas.width,this.canvas.height),this.entities.forEach((e)=>e.render()),this.emit("afterrender")}add(e){e.game=this,this.entities.add(e)}remove(e){this.entities.delete(e)}}class Ft{constructor(e){this.to=e.to,this.time=e.time||1e3,this.game=e.game,this.object=e.object,this.property=e.property,this.cb=e.cb}do_step(e){this.current_step=Te(1,(e-this.first_tick)/this.tick_delta*this.step),this.action()}action(){}pre_start(){this.tick_delta=this.game.tick_delta,this.first_tick=this.game.last_tick,this.number_of_ticks=Math.ceil(this.time/this.tick_delta),this.step=1/this.number_of_ticks}start(){return this.pre_start(),new Promise((e)=>{const t=(n)=>{1===this.current_step?(this.game.off("tick",t),e()):this.do_step(n,e)};this.game.on("tick",t)})}}class Rt{constructor(){this.uniforms={},this.attribs={}}setup_program(){if(this.program=q(I(ct.VERTEX_SHADER,this.get_shader_code(this.vertex_shader.variables,this.vertex_shader.body)),I(ct.FRAGMENT_SHADER,this.get_shader_code(this.fragment_shader.variables,this.fragment_shader.body))),this.program.error)return void console.log(this.program.error)}get_uniforms_and_attrs(e,t){e.forEach((e)=>{this.uniforms[e]=ct.getUniformLocation(this.program,e)}),t.forEach((e)=>{this.attribs[e]=ct.getAttribLocation(this.program,e)})}get_shader_code(e,t){return`
      precision mediump float;
      ${e}

      void main()
      {
        ${t}
      }
    `}render(e){let t=e,n=t.game;for(;t.parent&&!n;)t=t.parent,n=t.game;const[r,o]=e.get_components(ut,gt);ct.useProgram(this.program),ct.uniformMatrix4fv(this.uniforms.p,ct.FALSE,n.projMatrix),ct.uniformMatrix4fv(this.uniforms.v,ct.FALSE,n.viewMatrix),ct.uniformMatrix4fv(this.uniforms.w,ct.FALSE,r.world_matrix),ct.uniform4fv(this.uniforms.c,o.color_vec),this.apply_shader(e,n)}}const Tt=[0.5,0.5,0.5,0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5],wt=[0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21],Lt=[1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1];class Pt extends dt{constructor(e={}){e.components=[new ut,new gt({vertices:Tt,indices:wt,normals:Lt,material:e.material})],super(e)}}const St=[-1,0,1,1,0,1,1,0,-1,-1,0,-1],Bt=[0,1,3,3,1,2],Ut=[0,1,0,0,1,0,0,1,0,0,1,0];class It extends dt{constructor(e={}){e.components=[new ut,new gt({vertices:St,indices:Bt,normals:Ut,material:e.material})],super(e)}}const qt=0.5+2.23606797749979/2,Mt=[-1,qt,0,1,qt,0,-1,-qt,0,1,-qt,0,0,-1,qt,0,1,qt,0,-1,-qt,0,1,-qt,qt,0,-1,qt,0,1,-qt,0,-1,-qt,0,1],Dt=[-1,qt,0,1,qt,0,-1,-qt,0,1,-qt,0,0,-1,qt,0,1,qt,0,-1,-qt,0,1,-qt,qt,0,-1,qt,0,1,-qt,0,-1,-qt,0,1],Ct=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];class Ot extends dt{constructor(e={}){e.components=[new ut,new gt({vertices:Mt,indices:Ct,normals:Dt,material:e.material})],super(e)}}const Nt=new class extends Rt{constructor(){super(),this.vertex_shader={variables:`uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        gl_Position = p * v * vec4((w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz, 1.0);
      } else {
        gl_Position = p * v * vec4((w * vec4(P_current, 1.0)).xyz, 1.0);
      }`},this.fragment_shader={variables:"uniform vec4 c;",body:"gl_FragColor = c;"},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","c","frame_delta","do_morph"],["P_current","P_next"])}apply_shader(e){const[t,n]=e.get_components(gt,kt);let r=t.buffers;n?(r=t.buffers[n.current_frame],ct.bindBuffer(ct.ARRAY_BUFFER,t.buffers[n.next_frame].vertices),ct.vertexAttribPointer(this.attribs.P_next,3,ct.FLOAT,ct.FALSE,0,0),ct.enableVertexAttribArray(this.attribs.P_next),ct.uniform1f(this.uniforms.do_morph,1),ct.uniform1f(this.uniforms.frame_delta,n.frame_delta)):ct.uniform1f(this.uniforms.do_morph,0),ct.bindBuffer(ct.ARRAY_BUFFER,r.vertices),ct.vertexAttribPointer(this.attribs.P_current,3,ct.FLOAT,ct.FALSE,0,0),ct.enableVertexAttribArray(this.attribs.P_current),ct.bindBuffer(ct.ELEMENT_ARRAY_BUFFER,r.indices),ct.drawElements(ct.TRIANGLES,r.qty,ct.UNSIGNED_SHORT,0)}};const jt=new class extends Rt{constructor(){super(),this.vertex_shader={variables:`  uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;
        attribute vec3 N_current;
        attribute vec3 N_next;
        varying vec3 fp;
        varying vec3 fn;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        fp = (w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz;
        fn = (w * vec4(N_next * next_frame_delta + N_current * frame_delta, 0.0)).xyz;
      } else {
        fp = (w * vec4(P_current, 1.0)).xyz;
        fn = (w * vec4(N_current, 0.0)).xyz;
      }
      gl_Position = p * v * vec4(fp, 1.0);`},this.fragment_shader={variables:`uniform vec3 lp;
        uniform vec4 c;
        uniform vec2 li;
        varying vec3 fp;
        varying vec3 fn;`,body:`gl_FragColor = vec4(c.rgb * li.x + li.y * max(dot(fn, normalize(lp - fp)), 0.0), c.a);`},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","lp","li","c","do_morph","frame_delta"],["P_current","P_next","N_current","N_next"])}apply_shader(e,t){const[n,r]=e.get_components(gt,kt);let o=n.buffers;r?(o=n.buffers[r.current_frame],ct.bindBuffer(ct.ARRAY_BUFFER,n.buffers[r.next_frame].vertices),ct.vertexAttribPointer(this.attribs.P_next,3,ct.FLOAT,ct.FALSE,0,0),ct.enableVertexAttribArray(this.attribs.P_next),ct.uniform1f(this.uniforms.do_morph,1),ct.uniform1f(this.uniforms.frame_delta,r.frame_delta)):ct.uniform1f(this.uniforms.do_morph,0),ct.bindBuffer(ct.ARRAY_BUFFER,o.vertices),ct.vertexAttribPointer(this.attribs.P_current,3,ct.FLOAT,ct.FALSE,0,0),ct.enableVertexAttribArray(this.attribs.P_current),ct.bindBuffer(ct.ARRAY_BUFFER,o.normals),ct.vertexAttribPointer(this.attribs.N_current,3,ct.FLOAT,ct.FALSE,0,0),ct.enableVertexAttribArray(this.attribs.N_current),ct.bindBuffer(ct.ELEMENT_ARRAY_BUFFER,o.indices),ct.drawElements(ct.TRIANGLES,o.qty,ct.UNSIGNED_SHORT,0),ct.uniform3fv(this.uniforms.lp,t.light_position),ct.uniform2fv(this.uniforms.li,[t.light_intensity,1-t.light_intensity])}},Yt=132079672568928;let Gt=Yt;const Ht=function(){return Gt=16807*Gt%2147483647,(Gt-1)/2147483646},Vt=(e,t,n)=>{let r=[];const o=Ee(e*Ae),a=Ee(e*Ae),i=75+100*Fe(e*Ae/6);switch(n){case 0:case 1:for(let n=D(0,2);n--;){const n=D(5,80),s=D(5,80),c=new Pt;c.get_component(gt).set({material:Nt,color:t}),c.get_component(ut).set({position:[o*i+s,n/2,20*a*e],scale:[s,n,D(5,80)]}),r.push(c)}break;case 2:const s=new Ot,c=new Pt,m=D(12,17);c.get_component(ut).set({position:[o*i,m/2,20*a*e],scale:[1,m,1]}),c.get_component(gt).set({material:Nt,color:t}),r.push(c);const d=D(2,7);s.get_component(ut).set({position:[o*i,m,20*a*e],scale:[d,d,d]}),s.get_component(gt).set({material:Nt,color:t}),r.push(s);break;case 3:const _=new Pt;_.get_component(gt).set({color:"#000000",material:Nt}),_.get_component(ut).set({position:[0,1,0]}),r.push(_);}return r};class Wt extends ut{update(){this.position=this.entity.get_component(ut).position,this.look_at(this.target.position)}}const Xt=[2,1,0,6,3,0,6,0,9,2,0,3,2,1,0,6,3,0,6,0,9,2,0,3,19,1,2,19,1,2,2,16,19,2,16,19,2,3,16,2,3,16,16,3,6,16,6,17,16,3,6,16,6,17,7,18,17,7,17,6,7,18,17,7,17,6,10,11,18,10,18,7,10,11,18,10,18,7,8,11,10,8,10,7,8,11,10,8,10,7,9,8,7,9,8,7,9,7,6,9,7,6,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,4,12,3,4,12,3,5,13,4,13,12,4,5,13,4,13,12,4,15,14,12,15,12,13,15,14,12,15,12,13,14,15,5,14,15,5,5,15,13,5,15,13,20,21,22,29,20,23,23,20,22,20,21,22,29,20,23,23,20,22,22,21,39,22,21,39,36,23,22,39,36,22,36,23,22,39,36,22,37,23,36,37,23,36,26,37,38,37,26,23,26,37,38,37,26,23,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,27,38,30,27,30,28,27,38,30,27,30,28,38,31,30,38,31,30,30,31,28,30,31,28,33,32,34,33,34,35,23,34,32,25,35,34,33,32,34,33,34,35,23,34,32,25,35,34,24,33,35,24,32,33,24,33,35,24,32,33,23,32,24,23,32,24,23,24,25,23,24,25,24,35,25,24,35,25];class Qt extends Ft{action(){const e=[];u(e,this.from,this.to,this.current_step),this.object[this.property]=e}pre_start(){super.pre_start(),this.from=this.object[this.property].slice()}}const Kt=new AudioContext,Jt=[220,246.942,261.626,293.665,329.628,349.228,415.305,440],Zt=Kt.createBiquadFilter();Zt.type="lowpass",Zt.frequency.value=100,Zt.Q.value=10;const $t=Kt.createConvolver();$t.buffer=z(10,10),Zt.connect($t),$t.connect(Kt.destination);const zt={ifrq:0.0204082,atk:0.367347,dcy:0.183673,fmod1:0.0612245,atkf1:0,dcyf1:1,fmod2:0.285714,atkf2:0.22449,dcyf2:0.489796,amod1:0.367347,atka1:0.387755,dcya1:0.734694,amod2:0.204082,atka2:0.428571,dcya2:0.142857},en=4,tn=[[0,1,0.0432336,0,2.66717,-0.0897549,-0.311383,2.19602,0.234146,-0.63757,1.36243,0.125756,-2.39534,2.44478,-0.378434,-1.73172,-1.46682,-0.378434,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,-1.59801,-4.78739,0.125755,0,-5.27165,0.234146,-2.39534,2.44478,-0.126923,-3.45125,2.35058,-3.40775,-1.73172,-1.46682,-0.126923,-3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839,0,1,0.0432336,0,2.66717,-0.0897549,0.311383,2.19602,0.234146,0.63757,1.36243,0.125756,2.39534,2.44478,-0.378434,1.73172,-1.46682,-0.378434,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,1.59801,-4.78739,0.125755,0,-5.27165,0.234146,2.39534,2.44478,-0.126923,3.45125,2.35058,-3.40775,1.73172,-1.46682,-0.126923,3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839],[0,1,-0.18593,0,2.66717,-0.318919,-0.311383,2.19602,0.00498234,-0.63757,1.36243,0.125756,-2.13574,2.71753,0.924384,-1.27253,-1.44252,0.497551,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,-1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,-2.13066,2.69291,1.17464,-5.74559,1.12196,4.29641,-1.26745,-1.46715,0.747802,-5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227,0,1,-0.18593,0,2.66717,-0.318919,0.311383,2.19602,0.00498234,0.63757,1.36243,0.125756,2.13574,2.71753,0.924384,1.27253,-1.44252,0.497551,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,2.13066,2.69291,1.17464,5.74559,1.12196,4.29641,1.26745,-1.46715,0.747802,5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227]].map((e)=>({vertices:e,indices:Xt})),nn=1e3,rn=0.7,on=0.6,an=1.74,sn=25,cn=25;let mn=[],dn=[];const _n=5e3;let ln,fn={};const un={level:null,hue:0,target:null,results:[],clickable:!0,idle_reason:null},pn=function(...e){return function(t,n,r){return e.reduce((e,t)=>t(e,n,r),t)}}(function(e=Ve,t,r){switch(t){case Le:return n(e,{next:r});case Se:return n(e,{next:[null]});case Pe:{const{next:[t]}=e;return n(e,{current_scene:t})}default:return e;}},function(e=un,t,r){function o(){yn(Ye),vn(Me)}switch(t){case Oe:{te();const t=localStorage.getItem("results"),r=t?t.split(" ").map((e)=>parseInt(e)):[];return n(e,{results:r})}case Ie:{const[t]=r,[o,a]=me(t+1);return n(e,{index:t,level:o,hue:a,clickable:!1})}case He:{const{clickable:t}=e;return n(e,{clickable:!t})}case Ne:{const[t]=r;return n(e,{target:t})}case Ge:{const{level:t}=e;return t.canvas.requestPointerLock(),e}case qe:{const{level:t,hue:r,target:a}=e;return de(t,r,a),t.canvas.addEventListener("click",o),ue(),n(e,{idle_reason:null})}case je:{const[t]=r;return n(e,{idle_reason:t})}case Ye:{const{level:t,index:r,target:a,results:i}=e,s=_e(t,a),c=[...i.slice(0,r),s,...i.slice(r+1)];return pe(),t.canvas.removeEventListener("click",o),document.exitPointerLock(),localStorage.setItem("results",c.join(" ")),n(e,{results:c})}case De:return n(e,{level:null});default:return Object.assign({},un,e);}}),{attach:gn,connect:hn,dispatch:yn}=function(e){function t(){for(const[e,t]of r){const r=t();if(r!==o.get(e)){o.set(e,r),e.innerHTML=r;const t=new CustomEvent("render",{detail:n});e.dispatchEvent(t)}}}let n=e();const r=new Map,o=new Map;return{attach(e,n){r.set(n,e),t()},connect(e){return(...t)=>e(n,...t)},dispatch(r,...o){n=e(n,r,o),t()}}}(pn),vn=(...e)=>yn(Le,...e);window.dispatch=yn,window.goto=vn,yn(Oe);var bn=hn(function({next:t},{id:n,from:r,to:o,duration_in:a,duration_out:i},...s){const[c]=t;return null===c?s:e`
    ${s}
    ${c===n?ge(r,a):he(t,o,i)}`}),kn=hn(function({results:t}){const n=t.length?`goto(${De})`:`goto(${Ie}, 0)`;return bn({id:Ue,from:"#000",to:"#000"},e`
      <div class="ui action" onclick="${n}">
        <div class="pad">
          Collect your memories before they fade away.
        </div>
      </div>`)}),xn=hn(function({hue:e,clickable:t}){return bn({id:Ie,from:"#000",to:"#fff"},t?ve():ye(e))}),An=hn(function({idle_reason:t}){const n="keydown"===t?"Walk with the WASD keys.":"Move the mouse.";return bn({id:qe,from:"#fff",to:"#fff",duration_out:.1},e`<div class="ui"
      onclick="dispatch(${Ye}); goto(${Me})">
        ${t&&`<div style="opacity: 0; animation: fadein 2s 1s alternate 2;">${n}</div>`}</div>`)}),En=hn(function({results:t,index:n,target:r}){const o=t[n],a=15>o?"Doesn't look like it.":35>o?"It was something else.":50>o?"It's not quite the same.":75>o?"Could it be?":85>o?"It reminds you of something.":95>o?"That's it, almost there.":"Wonderful. You've found it.";return bn({id:Me,from:"#fff",duration_in:1.9,to:"#000"},e`
      <img class="ui"
        style="opacity: .5"
        src="${r.snapshot}">
      <div class="ui action"
        onclick="goto(${De})">
        <div class="pad" style="margin: 1.5rem 0 1rem;">${a}</div>
        <div>${t[n]}</div>
      </div>`)}),Fn=hn(function({results:t}){const n=t.reduce((e,t)=>e+t,0),r=xe(n/t.length),o=100*(1-2.5/t.length);return bn({id:De,from:"#000",to:"#000"},e`
      <div class="ui" style="background: #111">
        <div class="pad">
          ${t.map(be)}
          ${r>o?`<div class="box action"
                onclick="goto(${Ie}, ${t.length})">next</div>`:`<div class="box action"
                onclick="goto(${Ce})"
                title="Collect more accurate moments before advancing.">…?</div>`}
        </div>
      </div>`)});const Rn=[function(){return bn({id:Be,from:"#000",to:"#000"},e`
      <div class="ui action"
        onclick="goto(${Ue})">
        <div class="pad" style="margin: 1.3rem 0 1rem;">A moment lost in time.</div>
        <div style="font-size: 0.3rem; animation: fadein 1s 3s both">
          A story by <a href="https://piesku.com">piesku.com</a>.</div>
      </div>`)},kn,xn,An,En,Fn,function(){return bn({id:Ce,from:"#000",to:"#000"},e`
      <div class="ui action" style="background: #111"
        onclick="goto(${De})">
        <div class="pad">
          The path onward is never easy.
          Collect more accurate moments before venturing forth.
        </div>
      </div>`)}];var Tn=hn(function({current_scene:e}){const t=Rn[e];return t?t():""});gn(Tn,document.querySelector("#root"))})();
