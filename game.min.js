(function(){"use strict";function e([e,...t],...n){return n.reduce((e,n)=>e.concat(n,t.shift()),[e]).join("")}function n(...e){return Object.assign({},...e)}function r(e){return"#"===e.charAt(0)&&(e=e.substr(1)),3===e.length&&(e=e.split("").map((e)=>e+e).join("")),e.match(/.{1,2}/g).map((e)=>parseFloat((parseInt(e,16)/255).toFixed(2)))}function a(e){return e.reduce((e,t)=>{let n=(~~(255*t)).toString(16);return 1===n.length&&(n="0"+n),e+n},"#")}function o(e,t,n){let a,r,o;if(0==t)a=r=o=n;else{function i(e,n,r){return 0>r&&(r+=1),1<r&&(r-=1),r<1/6?e+6*(n-e)*r:r<1/2?n:r<2/3?e+6*((n-e)*(2/3-r)):e}let s=0.5>n?n*(1+t):n+t-n*t,c=2*n-s;a=i(c,s,e+1/3),r=i(c,s,e),o=i(c,s,e-1/3)}return[a,r,o]}function i(){let e=new Fe(3);return e[0]=0,e[1]=0,e[2]=0,e}function s(e,t,n){let r=new Fe(3);return r[0]=e,r[1]=t,r[2]=n,r}function c(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}function m(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e}function _(e,t,n){return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function d(e,t){let n=t[0]-e[0],r=t[1]-e[1],a=t[2]-e[2];return ke(n*n+r*r+a*a)}function p(e,t){let n=t[0],r=t[1],a=t[2],o=n*n+r*r+a*a;return 0<o&&(o=1/ke(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}function l(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function f(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[0],s=n[1],c=n[2];return e[0]=a*c-o*s,e[1]=o*i-r*c,e[2]=r*s-a*i,e}function u(e,n,r,a){let t=n[0],o=n[1],i=n[2];return e[0]=t+a*(r[0]-t),e[1]=o+a*(r[1]-o),e[2]=i+a*(r[2]-i),e}function g(e,t,n){let r=t[0],a=t[1],o=t[2],i=n[3]*r+n[7]*a+n[11]*o+n[15];return i=i||1,e[0]=(n[0]*r+n[4]*a+n[8]*o+n[12])/i,e[1]=(n[1]*r+n[5]*a+n[9]*o+n[13])/i,e[2]=(n[2]*r+n[6]*a+n[10]*o+n[14])/i,e}function h(){let e=new Fe(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=t[4],s=t[5],c=t[6],m=t[7],d=t[8],_=t[9],l=t[10],f=t[11],u=t[12],p=t[13],g=t[14],h=t[15],y=n*s-r*i,E=n*c-a*i,b=n*m-o*i,A=r*c-a*s,v=r*m-o*s,k=a*m-o*c,x=d*p-_*u,T=d*g-l*u,L=d*h-f*u,R=_*g-l*p,F=_*h-f*p,S=l*h-f*g,I=y*S-E*F+b*R+A*L-v*T+k*x;return I?(I=1/I,e[0]=(s*S-c*F+m*R)*I,e[1]=(a*F-r*S-o*R)*I,e[2]=(p*k-g*v+h*A)*I,e[3]=(l*v-_*k-f*A)*I,e[4]=(c*L-i*S-m*T)*I,e[5]=(n*S-a*L+o*T)*I,e[6]=(g*b-u*k-h*E)*I,e[7]=(d*k-l*b+f*E)*I,e[8]=(i*F-s*L+m*x)*I,e[9]=(r*L-n*F-o*x)*I,e[10]=(u*v-p*b+h*y)*I,e[11]=(_*b-d*v-f*y)*I,e[12]=(s*T-i*R-c*x)*I,e[13]=(n*R-r*T+a*x)*I,e[14]=(p*E-u*A-g*y)*I,e[15]=(d*A-_*E+l*y)*I,e):null}function E(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],s=t[4],c=t[5],m=t[6],d=t[7],_=t[8],l=t[9],f=t[10],u=t[11],p=t[12],g=t[13],h=t[14],y=t[15],E=n[0],b=n[1],A=n[2],v=n[3];return e[0]=E*r+b*s+A*_+v*p,e[1]=E*a+b*c+A*l+v*g,e[2]=E*o+b*m+A*f+v*h,e[3]=E*i+b*d+A*u+v*y,E=n[4],b=n[5],A=n[6],v=n[7],e[4]=E*r+b*s+A*_+v*p,e[5]=E*a+b*c+A*l+v*g,e[6]=E*o+b*m+A*f+v*h,e[7]=E*i+b*d+A*u+v*y,E=n[8],b=n[9],A=n[10],v=n[11],e[8]=E*r+b*s+A*_+v*p,e[9]=E*a+b*c+A*l+v*g,e[10]=E*o+b*m+A*f+v*h,e[11]=E*i+b*d+A*u+v*y,E=n[12],b=n[13],A=n[14],v=n[15],e[12]=E*r+b*s+A*_+v*p,e[13]=E*a+b*c+A*l+v*g,e[14]=E*o+b*m+A*f+v*h,e[15]=E*i+b*d+A*u+v*y,e}function b(e,t,n,r){let a=t[0],o=t[1],i=t[2],s=t[3],c=a+a,m=o+o,d=i+i,_=a*c,l=a*m,f=a*d,u=o*m,p=o*d,g=i*d,h=s*c,y=s*m,E=s*d,b=r[0],A=r[1],v=r[2];return e[0]=(1-(u+g))*b,e[1]=(l+E)*b,e[2]=(f-y)*b,e[3]=0,e[4]=(l-E)*A,e[5]=(1-(_+g))*A,e[6]=(p+h)*A,e[7]=0,e[8]=(f+y)*v,e[9]=(p-h)*v,e[10]=(1-(_+u))*v,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function A(e,t,n,r,a){let o=1/Math.tan(t/2),i=1/(r-a);return e[0]=o/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(a+r)*i,e[11]=-1,e[12]=0,e[13]=0,e[14]=2*a*r*i,e[15]=0,e}function v(e,t,n,r){let a,o,i,s,c,m,d,_,l,f,u=t[0],p=t[1],g=t[2],h=r[0],y=r[1],E=r[2],b=n[0],A=n[1],v=n[2];return Ae(u-b)<Re&&Ae(p-A)<Re&&Ae(g-v)<Re?mat4.identity(e):(d=u-b,_=p-A,l=g-v,f=1/ke(d*d+_*_+l*l),d*=f,_*=f,l*=f,a=y*l-E*_,o=E*d-h*l,i=h*_-y*d,f=ke(a*a+o*o+i*i),f?(f=1/f,a*=f,o*=f,i*=f):(a=0,o=0,i=0),s=_*i-l*o,c=l*a-d*i,m=d*o-_*a,f=ke(s*s+c*c+m*m),f?(f=1/f,s*=f,c*=f,m*=f):(s=0,c=0,m=0),e[0]=a,e[1]=s,e[2]=d,e[3]=0,e[4]=o,e[5]=c,e[6]=_,e[7]=0,e[8]=i,e[9]=m,e[10]=l,e[11]=0,e[12]=-(a*u+o*p+i*g),e[13]=-(s*u+c*p+m*g),e[14]=-(d*u+_*p+l*g),e[15]=1,e)}function k(){let e=new Fe(9);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e}function x(){let e=new Fe(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function T(){let e=new Fe(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function L(e,t,n){n*=0.5;let r=be(n);return e[0]=r*t[0],e[1]=r*t[1],e[2]=r*t[2],e[3]=Ee(n),e}function R(e,t,n){let r=t[0],a=t[1],o=t[2],i=t[3],s=n[0],c=n[1],m=n[2],d=n[3];return e[0]=r*d+i*s+a*m-o*c,e[1]=a*d+i*c+o*s-r*m,e[2]=o*d+i*m+r*c-a*s,e[3]=i*d-r*s-a*c-o*m,e}function F(e,n,r,a){let t,o,i,s,c,m=n[0],d=n[1],_=n[2],l=n[3],f=r[0],u=r[1],p=r[2],g=r[3];return o=m*f+d*u+_*p+l*g,0>o&&(o=-o,f=-f,u=-u,p=-p,g=-g),1e-6<1-o?(t=Math.acos(o),i=be(t),s=be((1-a)*t)/i,c=be(a*t)/i):(s=1-a,c=a),e[0]=s*m+c*f,e[1]=s*d+c*u,e[2]=s*_+c*p,e[3]=s*l+c*g,e}function S(e,t){let n,r=t[0]+t[4]+t[8];if(0<r)n=ke(r+1),e[3]=0.5*n,n=0.5/n,e[0]=(t[5]-t[7])*n,e[1]=(t[6]-t[2])*n,e[2]=(t[1]-t[3])*n;else{let r=0;t[4]>t[0]&&(r=1),t[8]>t[3*r+r]&&(r=2);let a=(r+1)%3,o=(r+2)%3;n=ke(t[3*r+r]-t[3*a+a]-t[3*o+o]+1),e[r]=0.5*n,n=0.5/n,e[3]=(t[3*a+o]-t[3*o+a])*n,e[a]=(t[3*a+r]+t[3*r+a])*n,e[o]=(t[3*o+r]+t[3*r+o])*n}return e}function I(e,t,n,r){const a=Float32Array.of(...t,...n,...r);return Ce(e,S(e,a))}function w(e){return e*ye/180}function P(e){const t=He.createBuffer();return He.bindBuffer(He.ARRAY_BUFFER,t),He.bufferData(He.ARRAY_BUFFER,new Float32Array(e),He.STATIC_DRAW),t}function N(e){const t=He.createBuffer();return He.bindBuffer(He.ELEMENT_ARRAY_BUFFER,t),He.bufferData(He.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),He.STATIC_DRAW),t}function B(e,t){const n=He.createShader(e);if(He.shaderSource(n,t),He.compileShader(n),!He.getShaderParameter(n,He.COMPILE_STATUS))throw He.getShaderInfoLog(n);return n}function D(e,t){const n=He.createProgram();if(He.attachShader(n,e),He.attachShader(n,t),He.linkProgram(n),!He.getProgramParameter(n,He.LINK_STATUS))throw He.getProgramInfoLog(n);return n}function O(e){xt=e}function U(e=0,t=1){return he(Tt()*(t-e+1)+e)}function C(e=0,t=1){return Tt()*(t-e)+e}function q(e){return e[U(0,e.length-1)]}function Y([e,t],n,r=1.5){const a=C(0,2*ye),o=C(0,n);return Oe(e+o*Ee(a),r,t+o*be(a))}function M(e){const t=C(-ye/10,ye/10),n=C(0,ye/6),r=Oe(Ee(n)*be(t),be(n),Ee(n)*Ee(t));return p(r,r),g(r,r,e)}function H(e,t){return e.reduce((e,n,r)=>e+n*t[r],0)}function j(e){return ke(H(e,e))}function G(e,t){const n=V.slice();return m(n,e,t),j(n)}function W(e){return ke(ge(1-e,2))}function X(e,t,n){const r=G(e,t),a=ke(n*n)/2;return Math.max(0,1-r/a)}function K(e,t){return Ae(H(e,t))}function Q(e,t,n){const a=t.get_component(Qe),o=t.get_component(Rt),i=X(e.position,a.position,n),s=K(e.rotation,a.rotation),c=K(a.rotation,o.rotation),m=s*(1-W(i))+c*W(i);return(i+m)/2/2}function z(e,t,n){const a=t.get_component(Qe),o=X(e.position,a.position,n),i=K(e.rotation,a.rotation);return(o*be(i)+i*be(o))/(0.8414709848078965*2)}function Z(e=0,t=1){return he(Math.random()*(t-e+1)+e)}function $(e){return e[Z(0,e.length-1)]}function J(e){const t=It.createOscillator();t.type="sine",t.frequency.value=e;const n=It.createGain();n.gain.setTargetAtTime(1,It.currentTime,.1),n.gain.setTargetAtTime(0,It.currentTime+1,.1),t.connect(n),n.connect(Pt),t.start(),t.stop(It.currentTime+10)}function ee(){const e=$(wt);J(e),setTimeout(ee,2e3+Z(0,1e4))}function te(e,t,n,r){this.modulator_gain=e.createGain(),this.modulator_gain.gain.value=r||300,n.connect(this.modulator_gain),this.modulator_gain.connect(t.frequency),this.connect=(e)=>{t.disconnect(),t.connect(e)},this.disconnect=(e)=>{t.disconnect(e)}}function ne(e,t,n){var r=e.createGain();r.gain.value=1,t.connect(r),n.connect(r.gain),this.connect=function(e){r.disconnect(),r.connect(e)}}function re(e,t,n,r,a,o){var i=6.90776;this.attack_time=n||0.9,this.decay_time=r||0.9,this.min=a||0,this.max=o||50,this.trigger=(n)=>{var r=n||e.currentTime;t.cancelScheduledValues(r),t.setValueAtTime(this.min,r),t.setTargetAtTime(this.max,r,this.attack_time/i),t.setTargetAtTime(this.min,r+this.attack_time+1/44100,this.decay_time/i)}}function ae(e,t){const n=7e3,r=300,a=0.9,o=3e3,i=It.createPanner();i.panningModel="equalpower",i.distanceModel="exponential",i.refDistance=0.3,i.setPosition(...e);const s=It.createOscillator(),c=It.createOscillator(),m=It.createOscillator(),d=It.createGain(),_=It.createGain(),l=It.createGain();c.connect(d),m.connect(_);const f=new te(It,s,d),u=new ne(It,f,_),p=new re(It,l.gain),g=new re(It,c.frequency),h=new re(It,m.frequency),y=new re(It,d.gain),E=new re(It,_.gain);u.connect(l),l.connect(i),i.connect(It.destination),f.modulator_gain.gain.value=r+n*Bt.ifrq,s.frequency.value=r+n*Bt.ifrq,p.attack_time=a*Bt.atk,p.decay_time=a*Bt.dcy,g.max=o*Bt.fmod1,g.attack_time=a*Bt.atkf1,g.decay_time=a*Bt.dcyf1,h.max=o*Bt.fmod2,h.attack_time=a*Bt.atkf2,h.decay_time=a*Bt.dcyf2,y.max=Bt.amod1,y.attack_time=a*Bt.atka1,y.decay_time=a*Bt.dcya1,E.max=-Bt.amod2,E.attack_time=a*Bt.atka2,E.decay_time=a*Bt.dcya2,l.gain.value=0,s.start(0),c.start(0),m.start(0),p.trigger(t),g.trigger(t),h.trigger(t),y.trigger(t),E.trigger(t)}function oe(e){for(let t=0;3>t;t++)setTimeout(()=>{ae(e,It.currentTime+0.4*Math.random())},1.2*(1e3*Bt.atk)*t)}function ie(e,t,n,r,a){oe(e);for(let o=0;o<r;o++)setTimeout(()=>{const r=Y([e[0],e[2]],n,100),o=new Ge({components:[new Qe({position:e,scale:[0.2,0.2,0.2]}),new Ze({material:At,color:t}),new nt({frame_time:16})]});o.get_component(nt).frames=Ot,o.get_component(Qe).look_at(r),o.get_component(Qe).rotate_ud(ye/2),o.get_component(nt).create_buffers(),a.add(o),new St({object:o.get_component(Qe),property:"position",to:r,time:1e3*Dt,game:a}).start().then(()=>{a.remove(o)})},15*o)}function se(e,t){const n=o(e,Ct,t);return a(n)}function ce(e){O(ge(kt/e,2)),Ht=[],jt=[];const t=new ot({width:window.innerWidth,height:window.innerHeight,clear_color:"#eeeeee",far:Ut});t.camera.add_component(new et({keyboard_controlled:!1,mouse_controlled:!1,move_speed:25,rotate_speed:.5}));const n=C(0,1),r=se(n,qt),a=new pt;a.get_component(Qe).scale=[Ut,1,Ut],a.get_component(Ze).set({material:At,color:r}),t.add(a);for(let n=0;n<ge(e,2)+1;n++)Lt(n,r,U(0,2)).forEach((e)=>{Ht.push(e),t.add(e)});t.camera.get_component(Qe).position=Y([0,0],Ut/3),t.camera.get_component(Qe).look_at(q(Ht).get_component(Qe).position),t.camera.get_component(Qe).look_at(M(t.camera.get_component(Qe).matrix)),delete t.camera.get_component(et).dir_desc[69],delete t.camera.get_component(et).dir_desc[81];const o=U(2,4);for(let t=0;t<o;t++){const e=Y([0,0],Ut/3,-3);jt.push(e)}return t.on("afterrender",function e(){t.off("afterrender",e);const n={snapshot:t.canvas.toDataURL(),position:t.camera.get_component(Qe).position,rotation:t.camera.get_component(Qe).rotation};window.dispatch(Te.SAVE_SNAPSHOT,n),t.stop()}),[t,n]}function me(e,t,n){e.camera.get_component(Qe).set({position:[0,Vt,0],rotation:T()}),e.camera.get_component(et).keyboard_controlled=!0,e.camera.get_component(et).mouse_controlled=!0,e.camera.add_component(new Rt({target:n}));for(const r of e.entities)r.get_component(Ze).color="#000000";e.start(),e.on("tick",()=>{for(let r=0;r<jt.length;r++)if(d(jt[r],e.camera.get_component(Qe).position)<Yt){ie(jt[r],se(t,qt*Q(n,e.camera,Ut)),Ut/5,Mt,e),jt.splice(r,1);break}}),e.on("afterrender",function(){const r=Q(n,e.camera,Ut);for(const n of e.entities)n.get_component(Ze).color=se(t,qt*r)})}function de(e,t){e.stop();const n=z(t,e.camera,Ut);return he(100*n)}function _e(e){Xt[e.type]=performance.now()}function le(){ue();for(const e of["mousemove","keydown"])if(Xt[e]+Gt<performance.now()){window.dispatch(Te.WARN_IDLE,e);break}}function fe(){window.addEventListener("mousemove",_e),window.addEventListener("keydown",_e),Wt=setTimeout(le,5e3);const e=performance.now();Xt={mousemove:e,keydown:e}}function ue(){window.removeEventListener("mousemove",_e),window.removeEventListener("keydown",_e),clearTimeout(Wt)}function pe(t,n){return e`
     <div class="box action"
       onclick="goto(${xe.FIND}, ${n})"
       style="padding: .5rem; color: #666;">
       ${t}</div>
  `}var ge=Math.pow,he=Math.floor,ye=Math.PI,Ee=Math.cos,be=Math.sin,Ae=Math.abs,ve=Math.min,ke=Math.sqrt;const xe={TITLE:0,INTRO:1,FIND:2,PLAY:3,SCORE:4,LEVELS:5},Te={INIT:10,SAVE_SNAPSHOT:11,WARN_IDLE:12,VALIDATE_SNAPSHOT:13},Le={current_scene:xe.TITLE,next_scene:xe.TITLE},Re=1e-6;let Fe="undefined"==typeof Float32Array?Array:Float32Array;const Se=function(e){let t=e[0],n=e[1],r=e[2];return ke(t*t+n*n+r*r)},Ie=function(){let e=i();return function(t,n,r,a,o,s){let c,i;for(n||(n=3),r||(r=0),i=a?ve(a*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],o(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2];return t}}(),we=Float32Array,V=we.of(0,0,0),Pe=we.of(1,1,1),Ne=we.of(1,0,0),Be=we.of(0,1,0),De=we.of(0,0,1),Oe=(...e)=>we.of(...e),Ue=function(){let e=x();return function(t,n,r,a,o,s){let c,i;for(n||(n=4),r||(r=0),i=a?ve(a*n+r,t.length):t.length,c=r;c<i;c+=n)e[0]=t[c],e[1]=t[c+1],e[2]=t[c+2],e[3]=t[c+3],o(e,e,s),t[c]=e[0],t[c+1]=e[1],t[c+2]=e[2],t[c+3]=e[3];return t}}(),Ce=function(e,t){let n=t[0],r=t[1],a=t[2],o=t[3],i=n*n+r*r+a*a+o*o;return 0<i&&(i=1/ke(i),e[0]=n*i,e[1]=r*i,e[2]=a*i,e[3]=o*i),e},qe=function(){let e=i(),t=s(1,0,0),n=s(0,1,0);return function(r,o,a){let i=l(o,a);return-0.999999>i?(f(e,t,o),1e-6>Se(e)&&f(e,n,o),p(e,e),L(r,e,Math.PI),r):0.999999<i?(r[0]=0,r[1]=0,r[2]=0,r[3]=1,r):(f(e,o,a),r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=1+i,Ce(r,r))}}(),Ve=function(){let e=T(),n=T();return function(r,o,a,i,s,c){return F(e,o,s,c),F(n,a,i,c),F(r,e,n,2*c*(1-c)),r}}(),Ye=function(){let e=k();return function(t,n,r,a){return e[0]=r[0],e[3]=r[1],e[6]=r[2],e[1]=a[0],e[4]=a[1],e[7]=a[2],e[2]=-n[0],e[5]=-n[1],e[8]=-n[2],Ce(t,S(t,e))}}(),Me=document.createElement("canvas"),He=Me.getContext("webgl"),je={components:[],skip:!1};class Ge{constructor(e={}){Object.assign(this,je,e),this.entities=new Set,this.components=new Map,this.add_components(e.components)}add_component(e){e.entity=this,e.mount(),this.components.set(e.constructor,e)}add_components(e=[]){e.forEach((e)=>this.add_component(e))}get_component(e){return this.components.get(e)}get_components(...e){return e.map((e)=>this.get_component(e))}add(e){e.parent=this,this.entities.add(e)}update(e){if(!this.skip){const t=(t)=>t.update(e);this.components.forEach(t),this.entities.forEach(t)}}render(e){if(!this.skip){const t=(t)=>t.render(e);this.components.forEach(t),this.entities.forEach(t)}}}const We={entity:null};class Xe{constructor(e){Object.assign(this,We,e)}mount(){}set(e){Object.assign(this,e)}update(){}render(){}}const Ke={_scale:Pe.slice(),_rotation:T(),scale:Pe.slice(),position:V.slice(),rotation:T()};class Qe extends Xe{constructor(e){super(Object.assign({matrix:h(),world_matrix:h(),world_to_self:h()},Ke,e))}get up(){const e=this.matrix.slice(4,7);return p(e,e)}get forward(){const e=this.matrix.slice(8,11);return p(e,e)}set position(e){b(this.matrix,this.rotation,e,this.scale)}get position(){return this.matrix.slice(12,15)}set scale(e){this._scale=e,b(this.matrix,this.rotation,this.position,e)}get scale(){return this._scale}set rotation(e){this._rotation=e,b(this.matrix,e,this.position,this.scale)}get rotation(){return this._rotation}look_at(e){const t=V.slice();m(t,e,this.position),p(t,t);const n=Oe(t[2],0,-t[0]);p(n,n);const r=V.slice();f(r,t,n);const a=T();I(a,n,r,t),this.rotation=a}rotate_along(e,t){const n=T();L(n,e,t),R(n,this.rotation,n),this.rotation=n}rotate_rl(e){this.rotate_along(Be,e)}rotate_ud(e){this.rotate_along(Ne,e)}translate(e){const t=V.slice();c(t,this.position,e),this.position=t}get_view_matrix(e){const t=[];return c(t,this.position,this.forward),v(e,this.position,t,this.up),e}update(){this.entity.parent?E(this.world_matrix,this.entity.parent.get_component(Qe).world_matrix,this.matrix):this.world_matrix=this.matrix.slice(),y(this.world_to_self,this.world_matrix)}}const ze={material:null,vertices:[],indices:[],normals:[],color:"fff",color_opacity:1};class Ze extends Xe{constructor(e){super(e),Object.assign(this,ze,e),this.create_buffers()}set color(e){this._color=e||"fff",this.color_vec=[...r(this._color),this.color_opacity]}get color(){return this._color}create_buffers(){this.buffers={vertices:P(this.vertices),indices:N(this.indices),qty:this.indices.length,normals:P(this.normals)}}render(){this.material.render(this.entity)}}const $e=3,Je={keyboard_controlled:!1,mouse_controlled:!1,move_speed:3.5,rotate_speed:.5,dir_desc:{37:"yl",38:"pu",39:"yr",40:"pd",65:"l",68:"r",69:"u",81:"d",83:"b",87:"f"}};class et extends Xe{constructor(e){super(e),Object.assign(this,Je,e)}handle_keys(e,{f:t=0,b:n=0,l:a=0,r:o=0,u:r=0,d:i=0,pu:s=0,pd:c=0,yl:d=0,yr:l=0}){const f=this.entity.get_component(Qe),u=e/1e3*this.move_speed,h=Oe(a-o,0,t-n);g(h,h,f.matrix),m(h,h,f.position),h[1]=r-i,p(h,h),_(h,h,u),f.translate(h);this.handle_mouse(e,{x:d*$e-l*$e,y:s*$e-c*$e})}handle_mouse(e,{x:t,y:n}){const r=this.entity.get_component(Qe);if(0!==t||0!==n){const a=e/1e3,o=this.rotate_speed*a*t,i=this.rotate_speed*a*n,s=Oe(Ee(i)*be(o),be(i),Ee(i)*Ee(o));p(s,s),g(s,s,r.matrix),r.look_at(s)}}update(e){if(this.keyboard_controlled&&this.entity.game){const t={};for(const[e,n]of Object.entries(this.dir_desc))t[n]=this.entity.game.get_key(e);this.handle_keys(e,t)}this.mouse_controlled&&this.entity.game&&this.handle_mouse(e,this.entity.game.mouse_delta)}}const tt={buffers:[],current_frame:0,next_frame:1,current_tick:0,frame_time:16};class nt extends Xe{constructor(e){super(e),Object.assign(this,tt,e),this.frames&&this.frames.length&&this.create_buffers()}create_buffers(){this.number_of_frames=this.frames.length,this.entity.get_component(Ze).buffers=this.frames.map((e)=>({vertices:P(e.vertices),indices:N(e.indices),qty:e.indices.length,normals:P(e.normals)}))}get_next_frame(){let e=this.current_frame;return e++,e%this.number_of_frames}update(){this.current_tick++,this.frame_delta=1-this.current_tick%this.frame_time/this.frame_time,this.current_tick%this.frame_time||(this.current_frame=this.next_frame,this.next_frame=this.get_next_frame())}}const rt={canvas:Me,width:800,height:600,dom:document.body,fps:60,running:!0,fov:60,near:0.35,far:85,clear_color:"#FFFFFF",light_position:V.slice(),light_intensity:0.6},at=["keydown","keyup","mousemove"];class ot{constructor(e){Object.assign(this,rt,e),this.canvas.width=this.width,this.canvas.height=this.height,this.dom.appendChild(Me),this.reset(),this.camera=new Ge({components:[new Qe,new et]}),this.camera.game=this,this.projMatrix=h(),this.viewMatrix=h(),A(this.projMatrix,w(this.fov),this.width/this.height,this.near,this.far),this.tick_delta=1e3/this.fps;for(const t of at){const e="on"+t;this[e]=this[e].bind(this),window.addEventListener(t,this[e])}this.running&&this.start(),He.enable(He.CULL_FACE),He.enable(He.DEPTH_TEST),He.clear(He.DEPTH_BUFFER_BIT|He.COLOR_BUFFER_BIT)}get clear_color(){return this._clear_color}set clear_color(e){this._clear_color=e;const t=r(e);He.clearColor(t[0],t[1],t[2],1)}stop(){this.running=!1}start(){this.running=!0,this.last_tick=performance.now(),window.requestAnimationFrame((e)=>this.frame(e))}reset(){this.entities=new Set,this.listeners=new Map,this.keys={},this.mouse_delta={x:0,y:0}}destroy(){for(const e of at)window.removeEventListener(e,this[e])}emit(e,...t){if(this.listeners.has(e))for(const n of this.listeners.get(e))n(...t)}on(e,t){this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t)}off(e,t){this.listeners.has(e)&&this.listeners.get(e).delete(t)}onkeydown(t){this.keys[t.keyCode]=1}onkeyup(t){this.keys[t.keyCode]=0}get_key(e){return this.keys[e]||0}onmousemove(t){this.mouse_delta.x-=t.movementX,this.mouse_delta.y-=t.movementY}frame(e){if(this.running&&window.requestAnimationFrame((e)=>this.frame(e)),e>this.last_tick+this.tick_delta){const t=e-this.last_tick,n=he(t/this.tick_delta);this.perform_ticks(n),this.render()}}perform_ticks(e){this.mouse_delta.x/=e,this.mouse_delta.y/=e;for(let t=0;t<e;t++)this.last_tick+=this.tick_delta,this.update();this.mouse_delta.x=0,this.mouse_delta.y=0}update(){this.emit("tick",this.last_tick),this.entities.forEach((e)=>e.update(this.tick_delta)),this.camera.update(this.tick_delta),this.camera.get_component(Qe).get_view_matrix(this.viewMatrix)}render(){He.clear(He.COLOR_BUFFER_BIT|He.DEPTH_BUFFER_BIT),He.viewport(0,0,this.canvas.width,this.canvas.height),this.entities.forEach((e)=>e.render()),this.emit("afterrender")}add(e){e.game=this,this.entities.add(e)}remove(e){this.entities.delete(e)}}class it{constructor(e){this.to=e.to,this.time=e.time||1e3,this.game=e.game,this.object=e.object,this.property=e.property,this.cb=e.cb}do_step(e){this.current_step=ve(1,(e-this.first_tick)/this.tick_delta*this.step),this.action()}action(){}pre_start(){this.tick_delta=this.game.tick_delta,this.first_tick=this.game.last_tick,this.number_of_ticks=Math.ceil(this.time/this.tick_delta),this.step=1/this.number_of_ticks}start(){return this.pre_start(),new Promise((e)=>{const t=(n)=>{1===this.current_step?(this.game.off("tick",t),e()):this.do_step(n,e)};this.game.on("tick",t)})}}class st{constructor(){this.uniforms={},this.attribs={}}setup_program(){if(this.program=D(B(He.VERTEX_SHADER,this.get_shader_code(this.vertex_shader.variables,this.vertex_shader.body)),B(He.FRAGMENT_SHADER,this.get_shader_code(this.fragment_shader.variables,this.fragment_shader.body))),this.program.error)return void console.log(this.program.error)}get_uniforms_and_attrs(e,t){e.forEach((e)=>{this.uniforms[e]=He.getUniformLocation(this.program,e)}),t.forEach((e)=>{this.attribs[e]=He.getAttribLocation(this.program,e)})}get_shader_code(e,t){return`
      precision mediump float;
      ${e}

      void main()
      {
        ${t}
      }
    `}render(e){let t=e,n=t.game;for(;t.parent&&!n;)t=t.parent,n=t.game;const[r,a]=e.get_components(Qe,Ze);He.useProgram(this.program),He.uniformMatrix4fv(this.uniforms.p,He.FALSE,n.projMatrix),He.uniformMatrix4fv(this.uniforms.v,He.FALSE,n.viewMatrix),He.uniformMatrix4fv(this.uniforms.w,He.FALSE,r.world_matrix),He.uniform4fv(this.uniforms.c,a.color_vec),this.apply_shader(e,n)}}const ct=[0.5,0.5,0.5,0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,-0.5,-0.5,-0.5,0.5,0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,0.5,-0.5,0.5,0.5,0.5,-0.5,-0.5,0.5,-0.5,0.5,-0.5,-0.5,-0.5,-0.5,-0.5],mt=[0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21],dt=[1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1];class _t extends Ge{constructor(e={}){e.components=[new Qe,new Ze({vertices:ct,indices:mt,normals:dt,material:e.material})],super(e)}}const lt=[-1,0,1,1,0,1,1,0,-1,-1,0,-1],ft=[0,1,3,3,1,2],ut=[0,1,0,0,1,0,0,1,0,0,1,0];class pt extends Ge{constructor(e={}){e.components=[new Qe,new Ze({vertices:lt,indices:ft,normals:ut,material:e.material})],super(e)}}const gt=0.5+2.23606797749979/2,ht=[-1,gt,0,1,gt,0,-1,-gt,0,1,-gt,0,0,-1,gt,0,1,gt,0,-1,-gt,0,1,-gt,gt,0,-1,gt,0,1,-gt,0,-1,-gt,0,1],yt=[-1,gt,0,1,gt,0,-1,-gt,0,1,-gt,0,0,-1,gt,0,1,gt,0,-1,-gt,0,1,-gt,gt,0,-1,gt,0,1,-gt,0,-1,-gt,0,1],Et=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];class bt extends Ge{constructor(e={}){e.components=[new Qe,new Ze({vertices:ht,indices:Et,normals:yt,material:e.material})],super(e)}}const At=new class extends st{constructor(){super(),this.vertex_shader={variables:`uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        gl_Position = p * v * vec4((w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz, 1.0);
      } else {
        gl_Position = p * v * vec4((w * vec4(P_current, 1.0)).xyz, 1.0);
      }`},this.fragment_shader={variables:"uniform vec4 c;",body:"gl_FragColor = c;"},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","c","frame_delta","do_morph"],["P_current","P_next"])}apply_shader(e){const[t,n]=e.get_components(Ze,nt);let r=t.buffers;n?(r=t.buffers[n.current_frame],He.bindBuffer(He.ARRAY_BUFFER,t.buffers[n.next_frame].vertices),He.vertexAttribPointer(this.attribs.P_next,3,He.FLOAT,He.FALSE,0,0),He.enableVertexAttribArray(this.attribs.P_next),He.uniform1f(this.uniforms.do_morph,1),He.uniform1f(this.uniforms.frame_delta,n.frame_delta)):He.uniform1f(this.uniforms.do_morph,0),He.bindBuffer(He.ARRAY_BUFFER,r.vertices),He.vertexAttribPointer(this.attribs.P_current,3,He.FLOAT,He.FALSE,0,0),He.enableVertexAttribArray(this.attribs.P_current),He.bindBuffer(He.ELEMENT_ARRAY_BUFFER,r.indices),He.drawElements(He.TRIANGLES,r.qty,He.UNSIGNED_SHORT,0)}};const vt=new class extends st{constructor(){super(),this.vertex_shader={variables:`  uniform mat4 p;
        uniform mat4 v;
        uniform mat4 w;
        uniform float frame_delta;
        uniform float do_morph;
        attribute vec3 P_current;
        attribute vec3 P_next;
        attribute vec3 N_current;
        attribute vec3 N_next;
        varying vec3 fp;
        varying vec3 fn;`,body:`if (do_morph == 1.0) {
        float next_frame_delta = 1.0 - frame_delta;
        fp = (w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz;
        fn = (w * vec4(N_next * next_frame_delta + N_current * frame_delta, 0.0)).xyz;
      } else {
        fp = (w * vec4(P_current, 1.0)).xyz;
        fn = (w * vec4(N_current, 0.0)).xyz;
      }
      gl_Position = p * v * vec4(fp, 1.0);`},this.fragment_shader={variables:`uniform vec3 lp;
        uniform vec4 c;
        uniform vec2 li;
        varying vec3 fp;
        varying vec3 fn;`,body:`gl_FragColor = vec4(c.rgb * li.x + li.y * max(dot(fn, normalize(lp - fp)), 0.0), c.a);`},this.setup_program(),this.get_uniforms_and_attrs(["p","v","w","lp","li","c","do_morph","frame_delta"],["P_current","P_next","N_current","N_next"])}apply_shader(e,t){const[n,r]=e.get_components(Ze,nt);let a=n.buffers;r?(a=n.buffers[r.current_frame],He.bindBuffer(He.ARRAY_BUFFER,n.buffers[r.next_frame].vertices),He.vertexAttribPointer(this.attribs.P_next,3,He.FLOAT,He.FALSE,0,0),He.enableVertexAttribArray(this.attribs.P_next),He.uniform1f(this.uniforms.do_morph,1),He.uniform1f(this.uniforms.frame_delta,r.frame_delta)):He.uniform1f(this.uniforms.do_morph,0),He.bindBuffer(He.ARRAY_BUFFER,a.vertices),He.vertexAttribPointer(this.attribs.P_current,3,He.FLOAT,He.FALSE,0,0),He.enableVertexAttribArray(this.attribs.P_current),He.bindBuffer(He.ARRAY_BUFFER,a.normals),He.vertexAttribPointer(this.attribs.N_current,3,He.FLOAT,He.FALSE,0,0),He.enableVertexAttribArray(this.attribs.N_current),He.bindBuffer(He.ELEMENT_ARRAY_BUFFER,a.indices),He.drawElements(He.TRIANGLES,a.qty,He.UNSIGNED_SHORT,0),He.uniform3fv(this.uniforms.lp,t.light_position),He.uniform2fv(this.uniforms.li,[t.light_intensity,1-t.light_intensity])}},kt=132079672568928;let xt=kt;const Tt=function(){return xt=16807*xt%2147483647,(xt-1)/2147483646},Lt=(e,t,n)=>{let r=[];const a=Ee(e*ye),o=Ee(e*ye),i=75+100*be(e*ye/6);switch(n){case 0:case 1:for(let n=U(0,2);n--;){const n=U(5,80),s=U(5,80),c=new _t;c.get_component(Ze).set({material:At,color:t}),c.get_component(Qe).set({position:[a*i+s,n/2,20*o*e],scale:[s,n,U(5,80)]}),r.push(c)}break;case 2:const s=new bt,c=new _t,m=U(12,17);c.get_component(Qe).set({position:[a*i,m/2,20*o*e],scale:[1,m,1]}),c.get_component(Ze).set({material:At,color:t}),r.push(c);const d=U(2,7);s.get_component(Qe).set({position:[a*i,m,20*o*e],scale:[d,d,d]}),s.get_component(Ze).set({material:At,color:t}),r.push(s);break;case 3:const _=new _t;_.get_component(Ze).set({color:"#000000",material:At}),_.get_component(Qe).set({position:[0,1,0]}),r.push(_);}return r};class Rt extends Qe{update(){this.position=this.entity.get_component(Qe).position,this.look_at(this.target.position)}}const Ft=[2,1,0,6,3,0,6,0,9,2,0,3,2,1,0,6,3,0,6,0,9,2,0,3,19,1,2,19,1,2,2,16,19,2,16,19,2,3,16,2,3,16,16,3,6,16,6,17,16,3,6,16,6,17,7,18,17,7,17,6,7,18,17,7,17,6,10,11,18,10,18,7,10,11,18,10,18,7,8,11,10,8,10,7,8,11,10,8,10,7,9,8,7,9,8,7,9,7,6,9,7,6,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,6,5,4,6,4,3,14,5,6,12,14,6,12,6,3,4,12,3,4,12,3,5,13,4,13,12,4,5,13,4,13,12,4,15,14,12,15,12,13,15,14,12,15,12,13,14,15,5,14,15,5,5,15,13,5,15,13,20,21,22,29,20,23,23,20,22,20,21,22,29,20,23,23,20,22,22,21,39,22,21,39,36,23,22,39,36,22,36,23,22,39,36,22,37,23,36,37,23,36,26,37,38,37,26,23,26,37,38,37,26,23,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,23,25,26,26,27,28,26,28,29,26,38,27,29,23,26,26,25,34,23,26,34,27,38,30,27,30,28,27,38,30,27,30,28,38,31,30,38,31,30,30,31,28,30,31,28,33,32,34,33,34,35,23,34,32,25,35,34,33,32,34,33,34,35,23,34,32,25,35,34,24,33,35,24,32,33,24,33,35,24,32,33,23,32,24,23,32,24,23,24,25,23,24,25,24,35,25,24,35,25];class St extends it{action(){const e=[];u(e,this.from,this.to,this.current_step),this.object[this.property]=e}pre_start(){super.pre_start(),this.from=this.object[this.property].slice()}}const It=new AudioContext,wt=[220,246.942,261.626,293.665,329.628,349.228,415.305,440],Pt=It.createBiquadFilter();Pt.type="lowpass",Pt.frequency.value=100,Pt.Q.value=10;const Nt=It.createConvolver();Nt.buffer=function(e,t){const n=It.sampleRate*e,r=It.createBuffer(2,n,It.sampleRate),a=r.getChannelData(0),o=r.getChannelData(1);for(let r=0;r<n;r++)a[r]=(2*Math.random()-1)*ge(1-r/n,t),o[r]=(2*Math.random()-1)*ge(1-r/n,t);return r}(10,10),Pt.connect(Nt),Nt.connect(It.destination);const Bt={ifrq:0.0204082,atk:0.367347,dcy:0.183673,fmod1:0.0612245,atkf1:0,dcyf1:1,fmod2:0.285714,atkf2:0.22449,dcyf2:0.489796,amod1:0.367347,atka1:0.387755,dcya1:0.734694,amod2:0.204082,atka2:0.428571,dcya2:0.142857},Dt=4,Ot=[[0,1,0.0432336,0,2.66717,-0.0897549,-0.311383,2.19602,0.234146,-0.63757,1.36243,0.125756,-2.39534,2.44478,-0.378434,-1.73172,-1.46682,-0.378434,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,-1.59801,-4.78739,0.125755,0,-5.27165,0.234146,-2.39534,2.44478,-0.126923,-3.45125,2.35058,-3.40775,-1.73172,-1.46682,-0.126923,-3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839,0,1,0.0432336,0,2.66717,-0.0897549,0.311383,2.19602,0.234146,0.63757,1.36243,0.125756,2.39534,2.44478,-0.378434,1.73172,-1.46682,-0.378434,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,0.108391,0,-1.67049,-0.39161,1.59801,-4.78739,0.125755,0,-5.27165,0.234146,2.39534,2.44478,-0.126923,3.45125,2.35058,-3.40775,1.73172,-1.46682,-0.126923,3.10363,0.637105,-3.60768,0,1,0.40839,0,-1.67049,0.464128,0,-2.87961,0.359902,0,2.16981,0.60839],[0,1,-0.18593,0,2.66717,-0.318919,-0.311383,2.19602,0.00498234,-0.63757,1.36243,0.125756,-2.13574,2.71753,0.924384,-1.27253,-1.44252,0.497551,-0.891271,-1.67049,0.125756,-2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,-1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,-2.13066,2.69291,1.17464,-5.74559,1.12196,4.29641,-1.26745,-1.46715,0.747802,-5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227,0,1,-0.18593,0,2.66717,-0.318919,0.311383,2.19602,0.00498234,0.63757,1.36243,0.125756,2.13574,2.71753,0.924384,1.27253,-1.44252,0.497551,0.891271,-1.67049,0.125756,2.88463,-2.81215,0.125755,0,-3.5,-0.120773,0,-1.67049,-0.620773,1.59801,-4.78739,0.125755,0,-5.27165,0.00498211,2.13066,2.69291,1.17464,5.74559,1.12196,4.29641,1.26745,-1.46715,0.747802,5.69843,-0.612202,4.29641,0,1,0.179227,0,-1.67049,0.234964,0,-2.87961,0.130738,0,2.16981,0.379227]].map((e)=>({vertices:e,indices:Ft})),Ut=1e3,Ct=0.7,qt=0.6,Vt=1.74,Yt=25,Mt=25;let Ht=[],jt=[];const Gt=5e3;let Wt,Xt={};const Kt={level:null,hue:0,target:null,results:[],idle_reason:null},Qt=function(...e){return function(t,n,r){return e.reduce((e,t)=>t(e,n,r),t)}}(function(e=Le,t,r){switch(t){case"T0":{const[t,...a]=r;return setTimeout(window.dispatch,1e3,t,...a),setTimeout(window.dispatch,2e3,"T1"),n(e,{next_scene:t})}case"T1":return n(e,{next_scene:null});case Te.INIT:return setTimeout(window.dispatch,1e3,"T1"),e;case xe.INTRO:case xe.FIND:case xe.PLAY:case xe.SCORE:case xe.LEVELS:{const{next_scene:t}=e;return n(e,{current_scene:t})}default:return e;}},function(e=Kt,t,r){switch(t){case Te.INIT:{ee();const t=localStorage.getItem("results"),r=t?t.split(" ").map((e)=>parseInt(e)):[];return n(e,{results:r})}case xe.FIND:{const[t]=r,[a,o]=ce(t+1);return n(e,{index:t,level:a,hue:o})}case Te.SAVE_SNAPSHOT:{const[t]=r;return n(e,{target:t})}case xe.PLAY:{const{level:t,hue:r,target:a}=e;return me(t,r,a),fe(),n(e,{idle_reason:null})}case Te.WARN_IDLE:{const[t]=r;return n(e,{idle_reason:t})}case Te.VALIDATE_SNAPSHOT:{const{level:t,index:r,target:a,results:o}=e,i=de(t,a),s=[...o.slice(0,r),i,...o.slice(r+1)];return ue(),localStorage.setItem("results",s.join(" ")),n(e,{results:s})}case xe.LEVELS:return n(e,{level:null});default:return Object.assign({},Kt,e);}}),{attach:zt,connect:Zt,dispatch:$t}=function(e){function t(){for(const[e,t]of r){const n=t();n!==a.get(e)&&(a.set(e,n),e.innerHTML=n)}}let n=e();const r=new Map,a=new Map;return{attach(e,n){r.set(n,e),t()},connect(e){return(...t)=>e(n,...t)},dispatch(r,...a){n=e(n,r,a),t()}}}(Qt);window.dispatch=$t,window.goto=(...e)=>$t("T0",...e),$t(Te.INIT);var Jt=Zt(function({next_scene:t},{id:n,from:r,to:a},...o){return e`
    ${o}
    ${null===t?null:t===n?`<div class="ui fadeout ${r}"></div>`:`<div class="ui fadein ${a}"></div>`}`}),en=Zt(function({results:t}){const n=t.length?`goto(${xe.LEVELS})`:`goto(${xe.FIND}, 0)`;return Jt({id:xe.INTRO,from:"black",to:"black"},e`
      <div class="ui action" onclick="${n}">
        <div class="pad" style="font-style: italic;">
          All those moments will be lost in time, like tears in rain.
        </div>
      </div>`)}),tn=Zt(function({next_scene:t,hue:n}){const r=t===xe.PLAY?null:`background: hsl(${360*n}, 70%, 60%); `+"animation: fadein 1s 1s forwards reverse";return Jt({id:xe.FIND,from:"black",to:"white"},e`
      <div class="ui" style="${r}"></div>
      <div class="ui action"
        onclick="goto(${xe.PLAY})">
        <div class="pad">Find this moment.</div>
      </div>`)}),nn=Zt(function({idle_reason:t}){const n="keydown"===t?"Walk with the WASD keys.":"Move the mouse.";return Jt({id:xe.PLAY,from:"white",to:"white"},e`<div class="ui"
      onclick="dispatch(${Te.VALIDATE_SNAPSHOT}); goto(${xe.SCORE})">
        ${t&&`<div style="opacity: 0; animation: fadein 2s 1s alternate 2;">${n}</div>`}</div>`)}),rn=Zt(function({results:t,index:n,target:r}){const a=t[n],o=15>a?"Doesn't look like it.":35>a?"It was something else.":50>a?"It's not quite the same.":75>a?"Could it be?":85>a?"It reminds you of something.":95>a?"That's it, almost there.":"Wonderful. You've found it.";return Jt({id:xe.SCORE,from:"white",to:"black"},e`
      <img class="ui"
        style="opacity: .5"
        src="${r.snapshot}">
      <div class="ui action"
        onclick="goto(${xe.LEVELS})">
        <div class="pad" style="margin: 1.5rem 0 1rem;">${o}</div>
        <div>${t[n]}</div>
      </div>`)}),an=Zt(function({results:t}){return Jt({id:xe.LEVELS,from:"black",to:"black"},e`
      <div class="ui black">
        <div class="pad">
          ${t.map(pe)}
          <div class="action"
            style="padding: .5rem;"
            onclick="goto(${xe.FIND}, ${t.length})">next</div>
        </div>
      </div>`)});const on=[function(){return Jt({id:xe.TITLE,from:"black",to:"black"},e`
      <div class="ui action"
        onclick="goto(${xe.INTRO})">
        <div class="pad" style="margin: 1.3rem 0 1rem;">A moment lost in time.</div>
        <div style="font-size: 0.3rem; animation: fadein 1s 3s both">
          A story by <a href="https://piesku.com">piesku.com</a>.</div>
      </div>`)},en,tn,nn,rn,an];var sn=Zt(function({current_scene:e}){const t=on[e];return t?t():""});zt(sn,document.querySelector("#root"))})();

