var $jscomp$templatelit$12=['\n    \x3cdiv class\x3d"ui"\n      onclick\x3d"dispatch(\'VALIDATE_SNAPSHOT\')"\x3e\x3c/div\x3e\n  '];$jscomp$templatelit$12.raw=['\n    \x3cdiv class\x3d"ui"\n      onclick\x3d"dispatch(\'VALIDATE_SNAPSHOT\')"\x3e\x3c/div\x3e\n  '];var $jscomp$templatelit$11=['\n    \x3cimg class\x3d"ui"\n      style\x3d"opacity: .5"\n      src\x3d"','"\x3e\n    \x3cdiv class\x3d"ui action"\n      onclick\x3d"dispatch(\'PLAY_AGAIN\')"\x3e\n      \x3cdiv\x3e',"%\x3c/div\x3e\n    \x3c/div\x3e\n  "];
$jscomp$templatelit$11.raw=['\n    \x3cimg class\x3d"ui"\n      style\x3d"opacity: .5"\n      src\x3d"','"\x3e\n    \x3cdiv class\x3d"ui action"\n      onclick\x3d"dispatch(\'PLAY_AGAIN\')"\x3e\n      \x3cdiv\x3e',"%\x3c/div\x3e\n    \x3c/div\x3e\n  "];var $jscomp$templatelit$10=['\n    \x3cdiv class\x3d"ui action"\n      onclick\x3d"dispatch(\'START_LEVEL\')"\x3e\n      \x3cdiv\x3eFind this moment.\x3c/div\x3e\n    \x3c/div\x3e\n  '];$jscomp$templatelit$10.raw=['\n    \x3cdiv class\x3d"ui action"\n      onclick\x3d"dispatch(\'START_LEVEL\')"\x3e\n      \x3cdiv\x3eFind this moment.\x3c/div\x3e\n    \x3c/div\x3e\n  '];
var $jscomp$templatelit$9=['\n    \x3cdiv class\x3d"ui"\n      style\x3d"background-color: #000"\x3e\n      \x3cdiv style\x3d"\n        display: flex;\n        flex-wrap: wrap;\n        max-width: 1280px;\n        max-height: 720px"\x3e\n      ','\n      \x3cdiv class\x3d"action"\n        style\x3d"padding: .5rem"\n        onclick\x3d"dispatch(\'PLAY_LEVEL\')"\x3enext\x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  '];
$jscomp$templatelit$9.raw=['\n    \x3cdiv class\x3d"ui"\n      style\x3d"background-color: #000"\x3e\n      \x3cdiv style\x3d"\n        display: flex;\n        flex-wrap: wrap;\n        max-width: 1280px;\n        max-height: 720px"\x3e\n      ','\n      \x3cdiv class\x3d"action"\n        style\x3d"padding: .5rem"\n        onclick\x3d"dispatch(\'PLAY_LEVEL\')"\x3enext\x3c/div\x3e\n      \x3c/div\x3e\n    \x3c/div\x3e\n  '];
var $jscomp$templatelit$8=['\n     \x3cdiv class\x3d"box"\n       style\x3d"padding: .5rem"\x3e\n       ',"%\x3c/div\x3e\n  "];$jscomp$templatelit$8.raw=['\n     \x3cdiv class\x3d"box"\n       style\x3d"padding: .5rem"\x3e\n       ',"%\x3c/div\x3e\n  "];var $jscomp$templatelit$7=['\n    \x3cdiv class\x3d"ui action"\n      onclick\x3d"dispatch(\'PLAY_NOW\')"\x3e\n      \x3cdiv\x3eA moment lost in time.\x3c/div\x3e\n    \x3c/div\x3e\n  '];$jscomp$templatelit$7.raw=['\n    \x3cdiv class\x3d"ui action"\n      onclick\x3d"dispatch(\'PLAY_NOW\')"\x3e\n      \x3cdiv\x3eA moment lost in time.\x3c/div\x3e\n    \x3c/div\x3e\n  '];
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,g){b!=Array.prototype&&b!=Object.prototype&&(b[d]=g.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var b=0;return function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+b++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var d=0;return $jscomp.iteratorPrototype(function(){return d<b.length?{done:!1,value:b[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.makeIterator=function(b){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=b[Symbol.iterator];return d?d.call(b):$jscomp.arrayIterator(b)};$jscomp.arrayFromIterator=function(b){for(var d,g=[];!(d=b.next()).done;)g.push(d.value);return g};
$jscomp.objectCreate=$jscomp.ASSUME_ES5||"function"==typeof Object.create?Object.create:function(b){var d=function(){};d.prototype=b;return new d};$jscomp.underscoreProtoCanBeSet=function(){var b={a:!0},d={};try{return d.__proto__=b,d.a}catch(g){}return!1};$jscomp.setPrototypeOf="function"==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(b,d){b.__proto__=d;if(b.__proto__!==d)throw new TypeError(b+" is not extensible");return b}:null;
$jscomp.inherits=function(b,d){b.prototype=$jscomp.objectCreate(d.prototype);b.prototype.constructor=b;if($jscomp.setPrototypeOf){var g=$jscomp.setPrototypeOf;g(b,d)}else for(g in d)if("prototype"!=g)if(Object.defineProperties){var h=Object.getOwnPropertyDescriptor(d,g);h&&Object.defineProperty(b,g,h)}else b[g]=d[g];b.superClass_=d.prototype};$jscomp.arrayFromIterable=function(b){return b instanceof Array?b:$jscomp.arrayFromIterator($jscomp.makeIterator(b))};
$jscomp.owns=function(b,d){return Object.prototype.hasOwnProperty.call(b,d)};$jscomp.polyfill=function(b,d,g,h){if(d){g=$jscomp.global;b=b.split(".");for(h=0;h<b.length-1;h++){var p=b[h];p in g||(g[p]={});g=g[p]}b=b[b.length-1];h=g[b];d=d(h);d!=h&&null!=d&&$jscomp.defineProperty(g,b,{configurable:!0,writable:!0,value:d})}};
$jscomp.polyfill("WeakMap",function(b){function d(b){$jscomp.owns(b,h)||$jscomp.defineProperty(b,h,{value:{}})}function g(b){var A=Object[b];A&&(Object[b]=function(b){d(b);return A(b)})}if(function(){if(!b||!Object.seal)return!1;try{var d=Object.seal({}),A=Object.seal({}),g=new b([[d,2],[A,3]]);if(2!=g.get(d)||3!=g.get(A))return!1;g.delete(d);g.set(A,4);return!g.has(d)&&4==g.get(A)}catch(S){return!1}}())return b;var h="$jscomp_hidden_"+Math.random().toString().substring(2);g("freeze");g("preventExtensions");
g("seal");var p=0,k=function(b){this.id_=(p+=Math.random()+1).toString();if(b){$jscomp.initSymbol();$jscomp.initSymbolIterator();b=$jscomp.makeIterator(b);for(var g;!(g=b.next()).done;)g=g.value,this.set(g[0],g[1])}};k.prototype.set=function(b,g){d(b);if(!$jscomp.owns(b,h))throw Error("WeakMap key fail: "+b);b[h][this.id_]=g;return this};k.prototype.get=function(b){return $jscomp.owns(b,h)?b[h][this.id_]:void 0};k.prototype.has=function(b){return $jscomp.owns(b,h)&&$jscomp.owns(b[h],this.id_)};k.prototype.delete=
function(b){return $jscomp.owns(b,h)&&$jscomp.owns(b[h],this.id_)?delete b[h][this.id_]:!1};return k},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(b){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),d=new b($jscomp.makeIterator([[g,"s"]]));if("s"!=d.get(g)||1!=d.size||d.get({x:4})||d.set({x:4},"t")!=d||2!=d.size)return!1;var h=d.entries(),k=h.next();if(k.done||k.value[0]!=g||"s"!=k.value[1])return!1;k=h.next();return k.done||4!=k.value[0].x||"t"!=k.value[1]||!h.next().done?!1:!0}catch(M){return!1}}())return b;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var d=new WeakMap,g=function(b){this.data_={};this.head_=k();this.size=0;if(b){b=$jscomp.makeIterator(b);for(var g;!(g=b.next()).done;)g=g.value,this.set(g[0],g[1])}};g.prototype.set=function(b,g){var d=h(this,b);d.list||(d.list=this.data_[d.id]=[]);d.entry?d.entry.value=g:(d.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:b,value:g},d.list.push(d.entry),this.head_.previous.next=d.entry,this.head_.previous=d.entry,this.size++);return this};g.prototype.delete=
function(b){b=h(this,b);return b.entry&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.data_[b.id],b.entry.previous.next=b.entry.next,b.entry.next.previous=b.entry.previous,b.entry.head=null,this.size--,!0):!1};g.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=k();this.size=0};g.prototype.has=function(b){return!!h(this,b).entry};g.prototype.get=function(b){return(b=h(this,b).entry)&&b.value};g.prototype.entries=function(){return p(this,function(b){return[b.key,
b.value]})};g.prototype.keys=function(){return p(this,function(b){return b.key})};g.prototype.values=function(){return p(this,function(b){return b.value})};g.prototype.forEach=function(b,g){for(var d=this.entries(),h;!(h=d.next()).done;)h=h.value,b.call(g,h[1],h[0],this)};g.prototype[Symbol.iterator]=g.prototype.entries;var h=function(b,g){var h=g&&typeof g;"object"==h||"function"==h?d.has(g)?h=d.get(g):(h=""+ ++R,d.set(g,h)):h="p_"+g;var k=b.data_[h];if(k&&$jscomp.owns(b.data_,h))for(b=0;b<k.length;b++){var p=
k[b];if(g!==g&&p.key!==p.key||g===p.key)return{id:h,list:k,index:b,entry:p}}return{id:h,list:k,index:-1,entry:void 0}},p=function(b,g){var d=b.head_;return $jscomp.iteratorPrototype(function(){if(d){for(;d.head!=b.head_;)d=d.previous;for(;d.next!=d.head;)return d=d.next,{done:!1,value:g(d)};d=null}return{done:!0,value:void 0}})},k=function(){var b={};return b.previous=b.next=b.head=b},R=0;return g},"es6","es3");
$jscomp.polyfill("Object.assign",function(b){return b?b:function(b,g){for(var d=1;d<arguments.length;d++){var p=arguments[d];if(p)for(var k in p)$jscomp.owns(p,k)&&(b[k]=p[k])}return b}},"es6","es3");
$jscomp.polyfill("Set",function(b){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!b||!b.prototype.entries||"function"!=typeof Object.seal)return!1;try{var g=Object.seal({x:4}),d=new b($jscomp.makeIterator([g]));if(!d.has(g)||1!=d.size||d.add(g)!=d||1!=d.size||d.add({x:4})!=d||2!=d.size)return!1;var p=d.entries(),k=p.next();if(k.done||k.value[0]!=g||k.value[1]!=g)return!1;k=p.next();return k.done||k.value[0]==g||4!=k.value[0].x||k.value[1]!=k.value[0]?!1:p.next().done}catch(R){return!1}}())return b;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var d=function(b){this.map_=new Map;if(b){b=$jscomp.makeIterator(b);for(var d;!(d=b.next()).done;)this.add(d.value)}this.size=this.map_.size};d.prototype.add=function(b){this.map_.set(b,b);this.size=this.map_.size;return this};d.prototype.delete=function(b){b=this.map_.delete(b);this.size=this.map_.size;return b};d.prototype.clear=function(){this.map_.clear();this.size=0};d.prototype.has=function(b){return this.map_.has(b)};d.prototype.entries=function(){return this.map_.entries()};
d.prototype.values=function(){return this.map_.values()};d.prototype.keys=d.prototype.values;d.prototype[Symbol.iterator]=d.prototype.values;d.prototype.forEach=function(b,d){var g=this;this.map_.forEach(function(h){return b.call(d,h,h,g)})};return d},"es6","es3");$jscomp.polyfill("Object.entries",function(b){return b?b:function(b){var d=[],h;for(h in b)$jscomp.owns(b,h)&&d.push([h,b[h]]);return d}},"es8","es3");
$jscomp.iteratorFromArray=function(b,d){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var g=0,h={next:function(){if(g<b.length){var p=g++;return{value:d(p,b[p]),done:!1}}h.next=function(){return{done:!0,value:void 0}};return h.next()}};h[Symbol.iterator]=function(){return h};return h};$jscomp.polyfill("Array.prototype.keys",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
(function(){function b(a,c){for(var e=[],m=1;m<arguments.length;++m)e[m-1]=arguments[m];m=$jscomp.makeIterator(a);var b=m.next().value,d=$jscomp.arrayFromIterator(m);return e.reduce(function(a,c){return a.concat(c,d.shift())},[b]).join("")}function d(a){"#"===a.charAt(0)&&(a=a.substr(1));3===a.length&&(a=a.split("").map(function(a){return a+a}).join(""));return a.match(/.{1,2}/g).map(function(a){return parseFloat((parseInt(a,16)/255).toFixed(2))})}function g(a){return a.reduce(function(a,e){e=(~~(255*
e)).toString(16);1===e.length&&(e="0"+e);return a+e},"#")}function h(a,c,e){if(0==c)e=c=a=e;else{var m=function(a,c,e){0>e&&(e+=1);1<e&&--e;return e<1/6?a+6*(c-a)*e:.5>e?c:e<2/3?a+(c-a)*(2/3-e)*6:a},b=.5>e?e*(1+c):e+c-e*c,d=2*e-b;e=m(d,b,a+1/3);c=m(d,b,a);a=m(d,b,a-1/3)}return[e,c,a]}function p(){var a=new N(3);a[0]=0;a[1]=0;a[2]=0;return a}function k(a,c,e){var m=new N(3);m[0]=a;m[1]=c;m[2]=e;return m}function R(a,c,e){a[0]=c[0]+e[0];a[1]=c[1]+e[1];a[2]=c[2]+e[2];return a}function A(a,c,e){a[0]=
c[0]-e[0];a[1]=c[1]-e[1];a[2]=c[2]-e[2];return a}function G(a,c){var e=c[0],m=c[1],b=c[2];e=e*e+m*m+b*b;0<e&&(e=1/Math.sqrt(e),a[0]=c[0]*e,a[1]=c[1]*e,a[2]=c[2]*e);return a}function S(a,c,e){var m=c[0],b=c[1];c=c[2];var d=e[0],f=e[1];e=e[2];a[0]=b*e-c*f;a[1]=c*d-m*e;a[2]=m*f-b*d;return a}function ca(a,c,e){var m=c[0],b=c[1];c=c[2];var d=e[3]*m+e[7]*b+e[11]*c+e[15];d=d||1;a[0]=(e[0]*m+e[4]*b+e[8]*c+e[12])/d;a[1]=(e[1]*m+e[5]*b+e[9]*c+e[13])/d;a[2]=(e[2]*m+e[6]*b+e[10]*c+e[14])/d;return a}function M(){var a=
new N(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a}function da(a,c,e,m){var b=c[0],d=c[1],f=c[2],g=c[3],C=b+b,h=d+d,D=f+f;c=b*C;var l=b*h;b*=D;var k=d*h;d*=D;f*=D;C*=g;h*=g;g*=D;D=m[0];var n=m[1];m=m[2];a[0]=(1-(k+f))*D;a[1]=(l+g)*D;a[2]=(b-h)*D;a[3]=0;a[4]=(l-g)*n;a[5]=(1-(c+f))*n;a[6]=(d+C)*n;a[7]=0;a[8]=(b+h)*m;a[9]=(d-C)*m;a[10]=(1-(c+k))*m;a[11]=0;a[12]=e[0];a[13]=e[1];a[14]=e[2];a[15]=1;return a}function Aa(){var a=
new N(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a}function Ba(){var a=new N(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a}function K(){var a=new N(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}function ka(a,c,e){e*=.5;var m=Math.sin(e);a[0]=m*c[0];a[1]=m*c[1];a[2]=m*c[2];a[3]=Math.cos(e);return a}function ea(a,c,e,m){var b=c[0],d=c[1],f=c[2];c=c[3];var g=e[0],h=e[1],l=e[2];e=e[3];var D=b*g+d*h+f*l+c*e;0>D&&(D=-D,g=-g,h=-h,l=-l,e=-e);if(.000001<1-D){var k=Math.acos(D);var n=Math.sin(k);
D=Math.sin((1-m)*k)/n;m=Math.sin(m*k)/n}else D=1-m;a[0]=D*b+m*g;a[1]=D*d+m*h;a[2]=D*f+m*l;a[3]=D*c+m*e;return a}function la(a,c){var e=c[0]+c[4]+c[8];if(0<e)e=Math.sqrt(e+1),a[3]=.5*e,e=.5/e,a[0]=(c[5]-c[7])*e,a[1]=(c[6]-c[2])*e,a[2]=(c[1]-c[3])*e;else{var m=0;c[4]>c[0]&&(m=1);c[8]>c[3*m+m]&&(m=2);var b=(m+1)%3,d=(m+2)%3;e=Math.sqrt(c[3*m+m]-c[3*b+b]-c[3*d+d]+1);a[m]=.5*e;e=.5/e;a[3]=(c[3*b+d]-c[3*d+b])*e;a[b]=(c[3*b+m]+c[3*m+b])*e;a[d]=(c[3*d+m]+c[3*m+d])*e}return a}function Z(a){var c=f.createBuffer();
f.bindBuffer(f.ARRAY_BUFFER,c);f.bufferData(f.ARRAY_BUFFER,new Float32Array(a),f.STATIC_DRAW);return c}function ma(a){var c=f.createBuffer();f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,c);f.bufferData(f.ELEMENT_ARRAY_BUFFER,new Uint16Array(a),f.STATIC_DRAW);return c}function na(a,c){a=f.createShader(a);f.shaderSource(a,c);f.compileShader(a);if(!f.getShaderParameter(a,f.COMPILE_STATUS))throw f.getShaderInfoLog(a);return a}function H(a,c){a=void 0===a?0:a;c=void 0===c?1:c;return Math.floor(oa()*(c-a+1)+a)}
function T(a,c){a=void 0===a?0:a;c=void 0===c?1:c;return oa()*(c-a)+a}function Ca(a,c,e){var b=$jscomp.makeIterator(a);a=b.next().value;b=b.next().value;e=void 0===e?1.5:e;var d=T(0,2*Math.PI);c=T(0,c);return U(a+c*Math.cos(d),e,b+c*Math.sin(d))}function Da(a){var c=T(-Math.PI/10,Math.PI/10),e=T(0,Math.PI/6);c=U(Math.cos(e)*Math.sin(c),Math.sin(e),Math.cos(e)*Math.cos(c));G(c,c);return ca(c,c,a)}function aa(a,c){return a.reduce(function(a,b,d){return a+b*c[d]},0)}function pa(a,c){var e=O.slice();
A(e,a,c);return Math.sqrt(aa(e,e))}function qa(a,c,e){a=pa(a,c);return Math.max(0,1-a/(Math.sqrt(e*e)/2))}function ra(a,c){a=void 0===a?0:a;return Math.floor(Math.random()*((void 0===c?1:c)-a+1)+a)}function sa(){var a=ta[ra(0,ta.length-1)],c=r.createOscillator();c.type="sine";c.frequency.value=a;a=r.createGain();a.gain.setTargetAtTime(1,r.currentTime,.1);a.gain.setTargetAtTime(0,r.currentTime+1,.1);c.connect(a);a.connect(V);c.start();c.stop(r.currentTime+10);setTimeout(sa,2E3+ra(0,1E4))}function ua(a,
c){a=h(a,.7,c);return g(a)}function Ea(a,c){var e=new q({width:window.innerWidth,height:window.innerHeight,clear_color:"#eeeeee",far:1E3});e.camera.components.delete(F);e.camera.add_component(new W({keyboard_controlled:!1,mouse_controlled:!1,move_speed:25,rotate_speed:.5}));c=ua(c,.6);var b=new va;b.get_component(n).scale=[1E3,1,1E3];b.get_component(t).set({material:ba,color:c});e.add(b);for(b=0;b<Math.pow(a,2)+1;b++)Fa(b,c).forEach(function(a){fa.push(a);e.add(a)});e.camera.get_component(n).position=
Ca([0,0],1E3/3);e.camera.get_component(n).look_at(fa[H(0,fa.length-1)].get_component(n).position);e.camera.get_component(n).look_at(Da(e.camera.get_component(n).matrix));e.on("afterrender",function za(){e.off("afterrender",za);var a={snapshot:e.canvas.toDataURL(),position:e.camera.get_component(n).position,rotation:e.camera.get_component(n).rotation};window.dispatch("SNAPSHOT_TAKEN",a);e.stop()});return e}function Ga(a,c,e){a.camera.get_component(n).set({position:[0,1.74,0],rotation:K()});a.camera.get_component(W).keyboard_controlled=
!0;a.camera.get_component(W).mouse_controlled=!0;a.camera.add_component(new X({target:e}));for(var b=$jscomp.makeIterator(a.entities),d=b.next();!d.done;d=b.next())d.value.get_component(t).color="#000000";a.start();a.on("afterrender",function(){var b=a.camera,m=b.get_component(n),d=b.get_component(X);b=qa(e.position,m.position,1E3);var f=Math.abs(aa(e.rotation,m.rotation));m=Math.abs(aa(m.rotation,d.rotation));m=(b+(f*(1-Math.sqrt(1-b**2))+m*Math.sqrt(1-b**2)))/2/2;b=$jscomp.makeIterator(a.entities);
for(f=b.next();!f.done;f=b.next())f.value.get_component(t).color=ua(c,.6*m)})}function P(a){for(var c=[],e=0;e<arguments.length;++e)c[e-0]=arguments[e];return Object.assign.apply(Object,[].concat([{}],$jscomp.arrayFromIterable(c)))}function Ha(a){return b($jscomp$templatelit$8,Math.floor(100*a))}var N="undefined"!==typeof Float32Array?Float32Array:Array;(function(){var a=p();return function(c,e,b,d,f,g){e||(e=3);b||(b=0);for(d=d?Math.min(d*e+b,c.length):c.length;b<d;b+=e)a[0]=c[b],a[1]=c[b+1],a[2]=
c[b+2],f(a,a,g),c[b]=a[0],c[b+1]=a[1],c[b+2]=a[2];return c}})();var L=Float32Array,O=L.of(0,0,0),l=L.of(1,1,1),Ia=L.of(1,0,0),Ja=L.of(0,1,0);L.of(0,0,1);var U=function(a){for(var c=[],e=0;e<arguments.length;++e)c[e-0]=arguments[e];return L.of.apply(L,[].concat($jscomp.arrayFromIterable(c)))};(function(){var a=Ba();return function(c,e,b,d,f,g){e||(e=4);b||(b=0);for(d=d?Math.min(d*e+b,c.length):c.length;b<d;b+=e)a[0]=c[b],a[1]=c[b+1],a[2]=c[b+2],a[3]=c[b+3],f(a,a,g),c[b]=a[0],c[b+1]=a[1],c[b+2]=a[2],
c[b+3]=a[3];return c}})();var ha=function(a,c){var e=c[0],b=c[1],d=c[2];c=c[3];var f=e*e+b*b+d*d+c*c;0<f&&(f=1/Math.sqrt(f),a[0]=e*f,a[1]=b*f,a[2]=d*f,a[3]=c*f);return a};(function(){var a=p(),c=k(1,0,0),e=k(0,1,0);return function(b,d,f){var m=d[0]*f[0]+d[1]*f[1]+d[2]*f[2];if(-.999999>m){S(a,c,d);f=a[0];m=a[1];var g=a[2];.000001>Math.sqrt(f*f+m*m+g*g)&&S(a,e,d);G(a,a);ka(b,a,Math.PI);return b}if(.999999<m)return b[0]=0,b[1]=0,b[2]=0,b[3]=1,b;S(a,d,f);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=1+m;return ha(b,
b)}})();(function(){var a=K(),c=K();return function(e,b,d,f,g,h){ea(a,b,g,h);ea(c,d,f,h);ea(e,a,c,2*h*(1-h));return e}})();(function(){var a=Aa();return function(c,e,b,d){a[0]=b[0];a[3]=b[1];a[6]=b[2];a[1]=d[0];a[4]=d[1];a[7]=d[2];a[2]=-e[0];a[5]=-e[1];a[8]=-e[2];return ha(c,la(c,a))}})();var ia=document.createElement("canvas"),f=ia.getContext("webgl"),Ka={components:[],skip:!1},v=function(a){a=void 0===a?{}:a;Object.assign(this,Ka,a);this.entities=new Set;this.components=new Map;this.add_components(a.components)};
v.prototype.add_component=function(a){a.entity=this;this.components.set(a.constructor,a)};v.prototype.add_components=function(a){var c=this;a=void 0===a?[]:a;a.forEach(function(a){return c.add_component(a)})};v.prototype.get_component=function(a){return this.components.get(a)};v.prototype.get_components=function(a){for(var c=[],e=0;e<arguments.length;++e)c[e-0]=arguments[e];var b=this;return c.map(function(a){return b.get_component(a)})};v.prototype.add=function(a){a.parent=this;this.entities.add(a)};
v.prototype.update=function(a){this.skip||(this.components.forEach(function(c){return c.update(a)}),this.entities.forEach(function(c){return c.update(a)}))};v.prototype.render=function(a){if(!this.skip){var c=function(c){return c.render(a)};this.components.forEach(c);this.entities.forEach(c)}};var La={entity:null},B=function(a){Object.assign(this,La,a)};B.prototype.set=function(a){Object.assign(this,a)};B.prototype.update=function(){};B.prototype.render=function(){};var wa={_scale:l.slice(),_rotation:K(),
scale:l.slice(),position:O.slice(),rotation:K()},n=function(a){var c=B.call(this,Object.assign({matrix:M(),world_matrix:M(),world_to_self:M()},wa,a))||this;Object.assign(c,wa,a);return c};$jscomp.inherits(n,B);n.prototype.look_at=function(a){var c=O.slice();A(c,a,this.position);G(c,c);var e=U(c[2],0,-c[0]);G(e,e);var b=O.slice();S(b,c,e);a=K();c=Float32Array.of.apply(Float32Array,[].concat($jscomp.arrayFromIterable(e),$jscomp.arrayFromIterable(b),$jscomp.arrayFromIterable(c)));ha(a,la(a,c));this.rotation=
a};n.prototype.rotate_along=function(a,c){var e=K();ka(e,a,c);var b=this.rotation;a=b[0];c=b[1];var d=b[2];b=b[3];var f=e[0],g=e[1],h=e[2],C=e[3];e[0]=a*C+b*f+c*h-d*g;e[1]=c*C+b*g+d*f-a*h;e[2]=d*C+b*h+a*g-c*f;e[3]=b*C-a*f-c*g-d*h;this.rotation=e};n.prototype.rotate_rl=function(a){this.rotate_along(Ja,a)};n.prototype.rotate_ud=function(a){this.rotate_along(Ia,a)};n.prototype.translate=function(a){var c=O.slice();R(c,this.position,a);this.position=c};n.prototype.get_view_matrix=function(a){var c=[];
R(c,this.position,this.forward);var e=this.position,b=this.up,d=e[0],f=e[1];e=e[2];var g=b[0];var h=b[1];var C=b[2];var l=c[0];b=c[1];var k=c[2];if(.000001>Math.abs(d-l)&&.000001>Math.abs(f-b)&&.000001>Math.abs(e-k))a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0;else{c=d-l;b=f-b;l=e-k;var n=1/Math.sqrt(c*c+b*b+l*l);c*=n;b*=n;l*=n;k=h*l-C*b;C=C*c-g*l;g=g*b-h*c;(n=Math.sqrt(k*k+C*C+g*g))?(n=1/n,k*=n,C*=n,g*=n):g=C=k=0;h=b*g-l*C;var p=l*
k-c*g;var q=c*C-b*k;(n=Math.sqrt(h*h+p*p+q*q))?(n=1/n,h*=n,p*=n,q*=n):q=p=h=0;a[0]=k;a[1]=h;a[2]=c;a[3]=0;a[4]=C;a[5]=p;a[6]=b;a[7]=0;a[8]=g;a[9]=q;a[10]=l;a[11]=0;a[12]=-(k*d+C*f+g*e);a[13]=-(h*d+p*f+q*e);a[14]=-(c*d+b*f+l*e)}a[15]=1;return a};n.prototype.update=function(){if(this.entity.parent){var a=this.world_matrix,c=this.entity.parent.get_component(n).world_matrix,e=this.matrix,b=c[0],d=c[1],f=c[2],g=c[3],h=c[4],l=c[5],k=c[6],p=c[7],q=c[8],r=c[9],t=c[10],v=c[11],A=c[12],B=c[13],u=c[14];c=c[15];
var w=e[0],x=e[1],y=e[2],z=e[3];a[0]=w*b+x*h+y*q+z*A;a[1]=w*d+x*l+y*r+z*B;a[2]=w*f+x*k+y*t+z*u;a[3]=w*g+x*p+y*v+z*c;w=e[4];x=e[5];y=e[6];z=e[7];a[4]=w*b+x*h+y*q+z*A;a[5]=w*d+x*l+y*r+z*B;a[6]=w*f+x*k+y*t+z*u;a[7]=w*g+x*p+y*v+z*c;w=e[8];x=e[9];y=e[10];z=e[11];a[8]=w*b+x*h+y*q+z*A;a[9]=w*d+x*l+y*r+z*B;a[10]=w*f+x*k+y*t+z*u;a[11]=w*g+x*p+y*v+z*c;w=e[12];x=e[13];y=e[14];z=e[15];a[12]=w*b+x*h+y*q+z*A;a[13]=w*d+x*l+y*r+z*B;a[14]=w*f+x*k+y*t+z*u;a[15]=w*g+x*p+y*v+z*c}else this.world_matrix=this.matrix.slice();
a=this.world_to_self;u=this.world_matrix;e=u[0];b=u[1];d=u[2];f=u[3];g=u[4];h=u[5];l=u[6];k=u[7];p=u[8];q=u[9];r=u[10];t=u[11];v=u[12];A=u[13];B=u[14];u=u[15];c=e*h-b*g;w=e*l-d*g;x=e*k-f*g;y=b*l-d*h;z=b*k-f*h;var F=d*k-f*l,G=p*A-q*v,H=p*B-r*v,I=p*u-t*v,J=q*B-r*A,K=q*u-t*A,L=r*u-t*B,E=c*L-w*K+x*J+y*I-z*H+F*G;E&&(E=1/E,a[0]=(h*L-l*K+k*J)*E,a[1]=(d*K-b*L-f*J)*E,a[2]=(A*F-B*z+u*y)*E,a[3]=(r*z-q*F-t*y)*E,a[4]=(l*I-g*L-k*H)*E,a[5]=(e*L-d*I+f*H)*E,a[6]=(B*x-v*F-u*w)*E,a[7]=(p*F-r*x+t*w)*E,a[8]=(g*K-h*I+
k*G)*E,a[9]=(b*I-e*K-f*G)*E,a[10]=(v*z-A*x+u*c)*E,a[11]=(q*x-p*z-t*c)*E,a[12]=(h*H-g*J-l*G)*E,a[13]=(e*J-b*H+d*G)*E,a[14]=(A*w-v*y-B*c)*E,a[15]=(p*y-q*w+r*c)*E)};$jscomp.global.Object.defineProperties(n.prototype,{up:{configurable:!0,enumerable:!0,get:function(){var a=this.matrix.slice(4,7);return G(a,a)}},forward:{configurable:!0,enumerable:!0,get:function(){var a=this.matrix.slice(8,11);return G(a,a)}},position:{configurable:!0,enumerable:!0,set:function(a){da(this.matrix,this.rotation,a,this.scale)},
get:function(){return this.matrix.slice(12,15)}},scale:{configurable:!0,enumerable:!0,set:function(a){this._scale=a;da(this.matrix,this.rotation,this.position,a)},get:function(){return this._scale}},rotation:{configurable:!0,enumerable:!0,set:function(a){this._rotation=a;da(this.matrix,a,this.position,this.scale)},get:function(){return this._rotation}}});var Ma={material:null,vertices:[],indices:[],normals:[],color:"fff",color_opacity:1},t=function(a){var c=B.call(this,a)||this;Object.assign(c,Ma,
a);c.create_buffers();return c};$jscomp.inherits(t,B);t.prototype.create_buffers=function(){this.buffers={vertices:Z(this.vertices),indices:ma(this.indices),qty:this.indices.length,normals:Z(this.normals)}};t.prototype.render=function(){this.material.render(this.entity)};$jscomp.global.Object.defineProperties(t.prototype,{color:{configurable:!0,enumerable:!0,set:function(a){this._color=a||"fff";this.color_vec=[].concat($jscomp.arrayFromIterable(d(this._color)),[this.color_opacity])},get:function(){return this._color}}});
var Na={keyboard_controlled:!1,mouse_controlled:!1,move_speed:3.5,rotate_speed:.5,dir_desc:{87:"f",65:"l",68:"r",83:"b",69:"u",81:"d",38:"pu",40:"pd",39:"yr",37:"yl"}},F=function(a){var c=B.call(this,a)||this;Object.assign(c,Na,a);return c};$jscomp.inherits(F,B);F.prototype.handle_keys=function(a,c){var b=c.f,d=c.b,f=c.l,g=c.r,h=c.u,l=c.d,k=c.pu,p=c.pd,q=c.yl;c=c.yr;var r=this.entity.get_component(n),t=a/1E3*this.move_speed;b=U(f-g,0,b-d);ca(b,b,r.matrix);A(b,b,r.position);b[1]=h-l;G(b,b);b[0]*=t;
b[1]*=t;b[2]*=t;r.translate(b);this.handle_mouse(a,{x:3*q-3*c,y:3*k-3*p})};F.prototype.handle_mouse=function(a,c){var b=c.x,d=c.y;c=this.entity.get_component(n);if(0!==b||0!==d)a/=1E3,b*=this.rotate_speed*a,d*=this.rotate_speed*a,b=U(Math.cos(d)*Math.sin(b),Math.sin(d),Math.cos(d)*Math.cos(b)),G(b,b),ca(b,b,c.matrix),c.look_at(b)};F.prototype.update=function(a){if(this.keyboard_controlled&&this.entity.game){for(var c={},b=$jscomp.makeIterator(Object.entries(this.dir_desc)),d=b.next();!d.done;d=b.next()){var f=
$jscomp.makeIterator(d.value);d=f.next().value;f=f.next().value;c[f]=this.entity.game.get_key(d)}this.handle_keys(a,c)}this.mouse_controlled&&this.entity.game&&this.handle_mouse(a,this.entity.game.mouse_delta)};var Oa={buffers:[],current_frame:0,next_frame:1,current_tick:0,frame_time:16},Q=function(a){var c=B.call(this,a)||this;Object.assign(c,Oa,a);c.frames&&c.frames.length&&c.create_buffers();return c};$jscomp.inherits(Q,B);Q.prototype.create_buffers=function(){this.number_of_frames=this.frames.length;
this.entity.get_component(t).buffers=this.frames.map(function(a){return{vertices:Z(a.vertices),indices:ma(a.indices),qty:a.indices.length,normals:Z(a.normals)}})};Q.prototype.get_next_frame=function(){var a=this.current_frame;a++;return a%this.number_of_frames};Q.prototype.update=function(){this.current_tick++;this.frame_delta=1-this.current_tick%this.frame_time/this.frame_time;this.current_tick%this.frame_time||(this.current_frame=this.next_frame,this.next_frame=this.get_next_frame())};var Pa={canvas:ia,
width:800,height:600,dom:document.body,fps:60,running:!0,fov:60,near:.35,far:85,clear_color:"#FFFFFF",light_position:O.slice(),light_intensity:.6},xa=["keydown","keyup","mousemove"],q=function(a){Object.assign(this,Pa,a);this.canvas.width=this.width;this.canvas.height=this.height;this.dom.appendChild(ia);this.reset();this.camera=new v({components:[new n,new F]});this.camera.game=this;this.projMatrix=M();this.viewMatrix=M();a=this.projMatrix;var c=this.near,b=this.far,d=1/Math.tan(this.fov*Math.PI/
180/2),g=1/(c-b);a[0]=d/(this.width/this.height);a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=d;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(b+c)*g;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*b*c*g;a[15]=0;this.tick_delta=1E3/this.fps;a=$jscomp.makeIterator(xa);for(c=a.next();!c.done;c=a.next())c=c.value,b="on"+c,this[b]=this[b].bind(this),window.addEventListener(c,this[b]);this.running&&this.start();f.enable(f.CULL_FACE);f.enable(f.DEPTH_TEST);f.clear(f.DEPTH_BUFFER_BIT|f.COLOR_BUFFER_BIT)};q.prototype.stop=function(){this.running=
!1};q.prototype.start=function(){var a=this;this.running=!0;this.last_tick=performance.now();window.requestAnimationFrame(function(c){return a.frame(c)})};q.prototype.reset=function(){this.entities=new Set;this.listeners=new Map;this.keys={};this.mouse_delta={x:0,y:0}};q.prototype.destroy=function(){for(var a=$jscomp.makeIterator(xa),c=a.next();!c.done;c=a.next())c=c.value,window.removeEventListener(c,this[c])};q.prototype.emit=function(a,c){for(var b=[],d=1;d<arguments.length;++d)b[d-1]=arguments[d];
if(this.listeners.has(a)){d=$jscomp.makeIterator(this.listeners.get(a));for(var f=d.next();!f.done;f=d.next())f.value.apply(null,[].concat($jscomp.arrayFromIterable(b)))}};q.prototype.on=function(a,b){this.listeners.has(a)||this.listeners.set(a,new Set);this.listeners.get(a).add(b)};q.prototype.off=function(a,b){this.listeners.has(a)&&this.listeners.get(a).delete(b)};q.prototype.onkeydown=function(a){this.keys[a.keyCode]=1};q.prototype.onkeyup=function(a){this.keys[a.keyCode]=0};q.prototype.get_key=
function(a){return this.keys[a]||0};q.prototype.onmousemove=function(a){this.mouse_delta.x-=a.movementX;this.mouse_delta.y-=a.movementY};q.prototype.frame=function(a){var b=this;this.running&&window.requestAnimationFrame(function(a){return b.frame(a)});a>this.last_tick+this.tick_delta&&(this.perform_ticks(Math.floor((a-this.last_tick)/this.tick_delta)),this.render())};q.prototype.perform_ticks=function(a){this.mouse_delta.x/=a;this.mouse_delta.y/=a;for(var b=0;b<a;b++)this.last_tick+=this.tick_delta,
this.update();this.mouse_delta.x=0;this.mouse_delta.y=0};q.prototype.update=function(){var a=this;this.emit("tick",this.last_tick);this.entities.forEach(function(b){return b.update(a.tick_delta)});this.camera.update(this.tick_delta);this.camera.get_component(n).get_view_matrix(this.viewMatrix)};q.prototype.render=function(){f.clear(f.COLOR_BUFFER_BIT|f.DEPTH_BUFFER_BIT);f.viewport(0,0,this.canvas.width,this.canvas.height);this.entities.forEach(function(a){return a.render()});this.emit("afterrender")};
q.prototype.add=function(a){a.game=this;this.entities.add(a)};q.prototype.remove=function(a){this.entities.delete(a)};$jscomp.global.Object.defineProperties(q.prototype,{clear_color:{configurable:!0,enumerable:!0,get:function(){return this._clear_color},set:function(a){this._clear_color=a;a=d(a);f.clearColor(a[0],a[1],a[2],1)}}});var I=function(){this.uniforms={};this.attribs={}};I.prototype.setup_program=function(){var a=na(f.VERTEX_SHADER,this.get_shader_code("vertex")),b=na(f.FRAGMENT_SHADER,this.get_shader_code("fragment")),
e=f.createProgram();f.attachShader(e,a);f.attachShader(e,b);f.linkProgram(e);if(!f.getProgramParameter(e,f.LINK_STATUS))throw f.getProgramInfoLog(e);this.program=e;this.program.error&&console.log(this.program.error)};I.prototype.get_uniforms_and_attrs=function(a,b){var c=this;a.forEach(function(a){c.uniforms[a]=f.getUniformLocation(c.program,a)});b.forEach(function(a){c.attribs[a]=f.getAttribLocation(c.program,a)})};I.prototype.get_shader_code=function(a){return"\n      precision mediump float;\n      "+
this[a+"_shader"].variables+"\n\n      void main()\n      {\n        "+this[a+"_shader"].body+"\n      }\n    "};I.prototype.render=function(a){for(var b=a,e=b.game;b.parent&&!e;)b=b.parent,e=b.game;var d=$jscomp.makeIterator(a.get_components(n,t));b=d.next().value;d=d.next().value;f.useProgram(this.program);f.uniformMatrix4fv(this.uniforms.p,f.FALSE,e.projMatrix);f.uniformMatrix4fv(this.uniforms.v,f.FALSE,e.viewMatrix);f.uniformMatrix4fv(this.uniforms.w,f.FALSE,b.world_matrix);f.uniform4fv(this.uniforms.c,
d.color_vec);this.apply_shader(a,e)};var Qa=[.5,.5,.5,.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5],Ra=[0,2,1,2,3,1,4,6,5,6,7,5,8,10,9,10,11,9,12,14,13,14,15,13,16,18,17,18,19,17,20,22,21,22,23,21],Sa=[1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,
0,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1],ja=function(a){a=void 0===a?{}:a;a.components=[new n,new t({vertices:Qa,indices:Ra,normals:Sa,material:a.material})];return v.call(this,a)||this};$jscomp.inherits(ja,v);var Ta=[-1,0,1,1,0,1,1,0,-1,-1,0,-1],Ua=[0,1,3,3,1,2],Va=[0,1,0,0,1,0,0,1,0,0,1,0],va=function(a){a=void 0===a?{}:a;a.components=[new n,new t({vertices:Ta,indices:Ua,normals:Va,material:a.material})];return v.call(this,a)||this};$jscomp.inherits(va,v);l=.5+Math.sqrt(5)/2;var Wa=
[-1,l,0,1,l,0,-1,-l,0,1,-l,0,0,-1,l,0,1,l,0,-1,-l,0,1,-l,l,0,-1,l,0,1,-l,0,-1,-l,0,1],Xa=[-1,l,0,1,l,0,-1,-l,0,1,-l,0,0,-1,l,0,1,l,0,-1,-l,0,1,-l,l,0,-1,l,0,1,-l,0,-1,-l,0,1],Ya=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],ya=function(a){a=void 0===a?{}:a;a.components=[new n,new t({vertices:Wa,indices:Ya,normals:Xa,material:a.material})];return v.call(this,a)||this};$jscomp.inherits(ya,v);l=function(){var a=I.call(this)||
this;a.vertex_shader={variables:"uniform mat4 p;\n        uniform mat4 v;\n        uniform mat4 w;\n        uniform float frame_delta;\n        uniform float do_morph;\n        attribute vec3 P_current;\n        attribute vec3 P_next;",body:"if (do_morph \x3d\x3d 1.0) {\n        float next_frame_delta \x3d 1.0 - frame_delta;\n        gl_Position \x3d p * v * vec4((w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz, 1.0);\n      } else {\n        gl_Position \x3d p * v * vec4((w * vec4(P_current, 1.0)).xyz, 1.0);\n      }"};
a.fragment_shader={variables:"uniform vec4 c;",body:"gl_FragColor \x3d c;"};a.setup_program();a.get_uniforms_and_attrs("p v w c frame_delta do_morph".split(" "),["P_current","P_next"]);return a};$jscomp.inherits(l,I);l.prototype.apply_shader=function(a){var b=$jscomp.makeIterator(a.get_components(t,Q));a=b.next().value;b=b.next().value;var e=a.buffers;b?(e=a.buffers[b.current_frame],f.bindBuffer(f.ARRAY_BUFFER,a.buffers[b.next_frame].vertices),f.vertexAttribPointer(this.attribs.P_next,3,f.FLOAT,f.FALSE,
0,0),f.enableVertexAttribArray(this.attribs.P_next),f.uniform1f(this.uniforms.do_morph,1),f.uniform1f(this.uniforms.frame_delta,b.frame_delta)):f.uniform1f(this.uniforms.do_morph,0);f.bindBuffer(f.ARRAY_BUFFER,e.vertices);f.vertexAttribPointer(this.attribs.P_current,3,f.FLOAT,f.FALSE,0,0);f.enableVertexAttribArray(this.attribs.P_current);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,e.indices);f.drawElements(f.TRIANGLES,e.qty,f.UNSIGNED_SHORT,0)};var ba=new l;l=function(){var a=I.call(this)||this;a.vertex_shader=
{variables:"  uniform mat4 p;\n        uniform mat4 v;\n        uniform mat4 w;\n        uniform float frame_delta;\n        uniform float do_morph;\n        attribute vec3 P_current;\n        attribute vec3 P_next;\n        attribute vec3 N_current;\n        attribute vec3 N_next;\n        varying vec3 fp;\n        varying vec3 fn;",body:"if (do_morph \x3d\x3d 1.0) {\n        float next_frame_delta \x3d 1.0 - frame_delta;\n        fp \x3d (w * vec4(P_next * next_frame_delta + P_current * frame_delta, 1.0)).xyz;\n        fn \x3d (w * vec4(N_next * next_frame_delta + N_current * frame_delta, 0.0)).xyz;\n      } else {\n        fp \x3d (w * vec4(P_current, 1.0)).xyz;\n        fn \x3d (w * vec4(N_current, 0.0)).xyz;\n      }\n      gl_Position \x3d p * v * vec4(fp, 1.0);"};
a.fragment_shader={variables:"uniform vec3 lp;\n        uniform vec4 c;\n        uniform vec2 li;\n        varying vec3 fp;\n        varying vec3 fn;",body:"gl_FragColor \x3d vec4(c.rgb * li.x + li.y * max(dot(fn, normalize(lp - fp)), 0.0), c.a);"};a.setup_program();a.get_uniforms_and_attrs("p v w lp li c do_morph frame_delta".split(" "),["P_current","P_next","N_current","N_next"]);return a};$jscomp.inherits(l,I);l.prototype.apply_shader=function(a,b){var c=$jscomp.makeIterator(a.get_components(t,
Q));a=c.next().value;c=c.next().value;var d=a.buffers;c?(d=a.buffers[c.current_frame],f.bindBuffer(f.ARRAY_BUFFER,a.buffers[c.next_frame].vertices),f.vertexAttribPointer(this.attribs.P_next,3,f.FLOAT,f.FALSE,0,0),f.enableVertexAttribArray(this.attribs.P_next),f.uniform1f(this.uniforms.do_morph,1),f.uniform1f(this.uniforms.frame_delta,c.frame_delta)):f.uniform1f(this.uniforms.do_morph,0);f.bindBuffer(f.ARRAY_BUFFER,d.vertices);f.vertexAttribPointer(this.attribs.P_current,3,f.FLOAT,f.FALSE,0,0);f.enableVertexAttribArray(this.attribs.P_current);
f.bindBuffer(f.ARRAY_BUFFER,d.normals);f.vertexAttribPointer(this.attribs.N_current,3,f.FLOAT,f.FALSE,0,0);f.enableVertexAttribArray(this.attribs.N_current);f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,d.indices);f.drawElements(f.TRIANGLES,d.qty,f.UNSIGNED_SHORT,0);f.uniform3fv(this.uniforms.lp,b.light_position);f.uniform2fv(this.uniforms.li,[b.light_intensity,1-b.light_intensity])};new l;var oa=function(){var a=19870603;return function(){a=16807*a%2147483647;return(a-1)/2147483646}}(),Fa=function(a,b){var c=
[],d=Math.cos(a*Math.PI),f=Math.cos(a*Math.PI),g=75+100*Math.sin(a*Math.PI/6);switch(H(0,2)){case 0:case 1:for(var h=H(0,2);h--;){var l=H(5,80),k=H(5,80),p=new ja;p.get_component(t).set({material:ba,color:b});p.get_component(n).set({position:[d*g+k,l/2,20*f*a],scale:[k,l,H(5,80)]});c.push(p)}break;case 2:h=new ya,k=new ja,l=H(12,17),k.get_component(n).set({position:[d*g,l/2,20*f*a],scale:[1,l,1]}),k.get_component(t).set({material:ba,color:b}),c.push(k),k=H(2,7),h.get_component(n).set({position:[d*
g,l,20*f*a],scale:[k,k,k]}),h.get_component(t).set({material:ba,color:b}),c.push(h)}return c},X=function(a){return n.apply(this,arguments)||this};$jscomp.inherits(X,n);X.prototype.update=function(){this.position=this.entity.get_component(n).position;this.look_at(this.target.position)};var r=new AudioContext,ta=[220,246.942,261.626,293.665,329.628,349.228,415.305,440],V=r.createBiquadFilter();V.type="lowpass";V.frequency.value=100;V.Q.value=10;l=r.createConvolver();l.buffer=function(a,b){a*=r.sampleRate;
for(var c=r.createBuffer(2,a,r.sampleRate),d=c.getChannelData(0),f=c.getChannelData(1),g=0;g<a;g++)d[g]=(2*Math.random()-1)*Math.pow(1-g/a,b),f[g]=(2*Math.random()-1)*Math.pow(1-g/a,b);return c}(10,10);V.connect(l);l.connect(r.destination);var W=function(a){a=F.call(this,a)||this;a.traveled=0;a.footstep_every=15;return a};$jscomp.inherits(W,F);W.prototype.handle_keys=function(a,b){var c=this.entity.get_component(n),d=c.position;F.prototype.handle_keys.call(this,a,b);this.traveled+=pa(d,c.position);
this.traveled>this.footstep_every&&(this.traveled%=this.footstep_every,c=void 0,c=void 0===c?50:c,a=r.createOscillator(),a.frequency.value=c,b=r.createOscillator(),b.frequency.value=c-20,c=r.createGain(),c.gain.value=1.5,c.gain.setTargetAtTime(0,r.currentTime+.005,.01),b.connect(c),a.connect(c),c.connect(r.destination),b.start(),a.start(),c=r.currentTime+.1,b.stop(c),a.stop(c))};var fa=[],Za={scene:"SCENE_TITLE",level:null,hue:0,target:null,results:[]},J=function(a){function b(){for(var a=$jscomp.makeIterator(d),
b=a.next();!b.done;b=a.next()){var c=$jscomp.makeIterator(b.value);b=c.next().value;c=c.next().value;c=c();c!==f.get(b)&&(f.set(b,c),b.innerHTML=c)}}var e=a(),d=new Map,f=new Map;return{attach:function(a,c){d.set(c,a);b()},connect:function(a){return function(b){for(var c=[],d=0;d<arguments.length;++d)c[d-0]=arguments[d];return a.apply(null,[].concat([e],$jscomp.arrayFromIterable(c)))}},dispatch:function(c,d){for(var f=[],g=1;g<arguments.length;++g)f[g-1]=arguments[g];e=a(e,c,f);b()}}}(function(a){return function(b,
d,f){console.group(d);console.log("Previous State",b);console.log("Action Arguments",f);b=a(b,d,f);console.log("Next State",b);console.groupEnd();return b}}(function(a,b,d){a=void 0===a?Za:a;switch(b){case "INIT":return sa(),P(a,{scene:"SCENE_TITLE"});case "PLAY_NOW":case "PLAY_LEVEL":return b=T(0,1),d=Ea(a.results.length+1,b),P(a,{scene:"SCENE_FIND",level:d,hue:b});case "SNAPSHOT_TAKEN":return b=$jscomp.makeIterator(d).next().value,P(a,{target:b});case "START_LEVEL":return b=a,Ga(b.level,b.hue,b.target),
P(a,{scene:"SCENE_PLAY"});case "VALIDATE_SNAPSHOT":b=a;var c=b.level;d=b.target;b=b.results;c.stop();c.reset();var e=c.camera;c=e.get_component(n);e.get_component(X);e=qa(d.position,c.position,1E3);d=Math.abs(aa(d.rotation,c.rotation))*(1-Math.sqrt(1-e**2));d=(e+d)/2;return P(a,{scene:"SCENE_SCORE",results:[].concat($jscomp.arrayFromIterable(b),[d])});case "PLAY_AGAIN":return P(a,{scene:"SCENE_LEVELS",level:null});default:return a}}));l=J.attach;var Y=J.connect;J=J.dispatch;J("INIT");window.dispatch=
J;J=Y(function(a){return b($jscomp$templatelit$9,a.results.map(Ha))});var $a=Y(function(a){var c=a.results;return b($jscomp$templatelit$11,a.target.snapshot,Math.floor(100*c[c.length-1]))}),ab={SCENE_TITLE:function(){return b($jscomp$templatelit$7)},SCENE_LEVELS:J,SCENE_FIND:function(){return b($jscomp$templatelit$10)},SCENE_SCORE:$a,SCENE_PLAY:function(){return b($jscomp$templatelit$12)}};Y=Y(function(a){return(a=ab[a.scene])?a():""});l(Y,document.querySelector("#root"))})();
